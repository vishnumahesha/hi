<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LifeMAX - See Your Current Self. Unlock Your Potential.</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #8B5CF6;
      --primary-dark: #7C3AED;
      --primary-light: #A78BFA;
      --accent: #06B6D4;
      --accent-body: #10B981;
      --background: #0A0A0F;
      --surface: #12121A;
      --surface-light: #1E1E2E;
      --text: #FAFAFA;
      --text-secondary: #A1A1AA;
      --text-muted: #71717A;
      --success: #10B981;
      --warning: #F59E0B;
      --error: #EF4444;
    }

    html {
      scroll-behavior: smooth;
    }

    /* Page sections - only show active one */
    .page-section {
      display: none;
      min-height: calc(100vh - 70px);
      padding-top: 80px;
    }

    .page-section.active {
      display: block;
      animation: pageFadeIn 0.4s ease-out;
    }

    @keyframes pageFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Active nav link styling */
    .nav-links a.active {
      color: var(--primary);
      position: relative;
    }

    .nav-links a.active::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary);
      box-shadow: 0 0 10px var(--primary);
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--background);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Animated background */
    .bg-gradient {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: -1;
      overflow: hidden;
    }

    .bg-gradient::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 30% 30%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                  radial-gradient(circle at 70% 70%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(5deg); }
      66% { transform: translate(-20px, 20px) rotate(-5deg); }
    }

    /* Navigation */
    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 1rem 2rem;
      background: rgba(10, 10, 15, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      text-decoration: none;
      text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    .logo-icon {
      font-size: 1.8rem;
      filter: drop-shadow(0 0 8px rgba(139, 92, 246, 0.6));
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }

    .nav-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
    }

    .nav-links a:hover {
      color: var(--primary);
    }

    /* Scan Type Dropdown */
    .scan-dropdown {
      position: relative;
    }

    .scan-dropdown-btn {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--text);
      padding: 0.6rem 1.5rem;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: transform 0.3s, box-shadow 0.3s;
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
      cursor: pointer;
      border: none;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .scan-dropdown-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.6), 0 10px 30px rgba(139, 92, 246, 0.3);
    }

    .scan-dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      min-width: 200px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    .scan-dropdown:hover .scan-dropdown-content {
      display: block;
      animation: dropdownFadeIn 0.2s ease-out;
    }

    @keyframes dropdownFadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .scan-option {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      color: var(--text);
    }

    .scan-option:hover {
      background: var(--surface-light);
    }

    .scan-option-icon {
      font-size: 1.5rem;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
    }

    .scan-option-icon.face {
      background: rgba(139, 92, 246, 0.2);
    }

    .scan-option-icon.body {
      background: rgba(16, 185, 129, 0.2);
    }

    .scan-option-text {
      flex: 1;
    }

    .scan-option-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .scan-option-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Hero Section */
    .hero {
      min-height: calc(100vh - 80px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem 2rem 4rem;
      position: relative;
    }

    .hero-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: center;
    }

    .hero-content {
      animation: fadeInUp 1s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(139, 92, 246, 0.15);
      border: 1px solid rgba(139, 92, 246, 0.4);
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-size: 0.875rem;
      color: var(--primary-light);
      margin-bottom: 1.5rem;
      box-shadow: 0 0 25px rgba(139, 92, 246, 0.3), inset 0 0 15px rgba(139, 92, 246, 0.1);
    }

    .hero-badge span {
      animation: pulse 2s infinite;
      filter: drop-shadow(0 0 6px rgba(139, 92, 246, 0.8));
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .hero h1 {
      font-size: 4rem;
      font-weight: 800;
      line-height: 1.1;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, var(--text) 0%, var(--text-secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero h1 .highlight {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 30px rgba(139, 92, 246, 0.6));
    }

    .hero-description {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      max-width: 500px;
    }

    .hero-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .btn {
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s;
      cursor: pointer;
      border: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--text);
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), 0 4px 20px rgba(139, 92, 246, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.7), 0 8px 30px rgba(139, 92, 246, 0.4);
    }

    .btn-body {
      background: linear-gradient(135deg, var(--accent-body), #059669);
      color: var(--text);
      box-shadow: 0 0 30px rgba(16, 185, 129, 0.5), 0 4px 20px rgba(16, 185, 129, 0.3);
    }

    .btn-body:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.7), 0 8px 30px rgba(16, 185, 129, 0.4);
    }

    .btn-secondary {
      background: var(--surface-light);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
    }

    .btn-secondary:hover {
      background: var(--surface);
      border-color: var(--primary);
      box-shadow: 0 0 25px rgba(139, 92, 246, 0.3);
    }

    /* Phone mockup */
    .hero-visual {
      display: flex;
      justify-content: center;
      animation: fadeInUp 1s ease-out 0.3s both;
    }

    .phone-mockup {
      position: relative;
      width: 320px;
      height: 650px;
      background: linear-gradient(145deg, #1a1a2e, #0f0f1a);
      border-radius: 50px;
      padding: 12px;
      box-shadow: 
        0 50px 100px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.1),
        0 0 60px rgba(139, 92, 246, 0.3),
        0 0 120px rgba(6, 182, 212, 0.15),
        inset 0 0 30px rgba(139, 92, 246, 0.15);
    }

    .phone-screen {
      width: 100%;
      height: 100%;
      background: var(--background);
      border-radius: 40px;
      overflow: hidden;
      position: relative;
    }

    .phone-notch {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 30px;
      background: #000;
      border-radius: 0 0 20px 20px;
      z-index: 10;
    }

    .screen-content {
      padding: 50px 20px 20px;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .rating-circle {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: conic-gradient(var(--success) 0deg, var(--success) 252deg, var(--surface-light) 252deg);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin: 20px 0;
      animation: rotateIn 1.5s ease-out 0.8s both;
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.4), 0 0 80px rgba(16, 185, 129, 0.2);
    }

    @keyframes rotateIn {
      from {
        opacity: 0;
        transform: scale(0.5) rotate(-180deg);
      }
      to {
        opacity: 1;
        transform: scale(1) rotate(0);
      }
    }

    .rating-inner {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background: var(--background);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .rating-value {
      font-size: 3rem;
      font-weight: 800;
      color: var(--success);
      text-shadow: 0 0 20px rgba(16, 185, 129, 0.8);
    }

    .rating-label {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .feature-bars {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .feature-bar {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .feature-icon {
      font-size: 1.2rem;
      width: 30px;
    }

    .feature-track {
      flex: 1;
      height: 8px;
      background: var(--surface-light);
      border-radius: 4px;
      overflow: hidden;
    }

    .feature-fill {
      height: 100%;
      border-radius: 4px;
      animation: fillBar 1.5s ease-out forwards;
      animation-delay: calc(var(--delay) * 0.2s + 1s);
      width: 0;
      box-shadow: 0 0 10px currentColor;
    }

    @keyframes fillBar {
      to { width: var(--width); }
    }

    .feature-score {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      min-width: 30px;
    }

    /* Scan Type Selector Section */
    .scan-selector-section {
      padding: 4rem 2rem;
      background: linear-gradient(180deg, transparent, rgba(139, 92, 246, 0.03), transparent);
    }

    .scan-selector-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .scan-selector-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .scan-selector-header h2 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .scan-selector-header p {
      color: var(--text-secondary);
    }

    .scan-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .scan-card {
      background: var(--surface);
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .scan-card.face {
      border-color: rgba(139, 92, 246, 0.3);
    }

    .scan-card.face:hover {
      border-color: var(--primary);
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.3);
      transform: translateY(-5px);
    }

    .scan-card.body {
      border-color: rgba(16, 185, 129, 0.3);
    }

    .scan-card.body:hover {
      border-color: var(--success);
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.3);
      transform: translateY(-5px);
    }

    .scan-card-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .scan-card h3 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .scan-card p {
      color: var(--text-secondary);
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }

    .scan-card-features {
      list-style: none;
      margin-top: 1rem;
    }

    .scan-card-features li {
      color: var(--text-muted);
      font-size: 0.875rem;
      padding: 0.25rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .scan-card-features li::before {
      content: 'âœ“';
      color: var(--success);
      font-weight: 600;
    }

    /* Upload Section */
    .upload-section {
      padding: 2rem 2rem 4rem;
      background: linear-gradient(180deg, transparent, rgba(139, 92, 246, 0.05), transparent);
      min-height: calc(100vh - 150px);
    }

    .upload-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .upload-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .upload-header h2 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      text-shadow: 0 0 30px rgba(139, 92, 246, 0.4);
    }

    .upload-header p {
      color: var(--text-secondary);
      font-size: 1.125rem;
    }

    /* Scan Type Toggle */
    .scan-type-toggle {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 2rem;
      background: var(--surface);
      padding: 0.5rem;
      border-radius: 12px;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }

    .scan-type-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .scan-type-btn.active.face {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--text);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
    }

    .scan-type-btn.active.body {
      background: linear-gradient(135deg, var(--accent-body), #059669);
      color: var(--text);
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
    }

    .upload-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .upload-box {
      background: var(--surface);
      border: 2px dashed rgba(139, 92, 246, 0.4);
      border-radius: 20px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.1), inset 0 0 30px rgba(139, 92, 246, 0.05);
    }

    .upload-box.body-mode {
      border-color: rgba(16, 185, 129, 0.4);
      box-shadow: 0 0 30px rgba(16, 185, 129, 0.1), inset 0 0 30px rgba(16, 185, 129, 0.05);
    }

    .upload-box:hover {
      border-color: var(--primary);
      background: var(--surface-light);
      box-shadow: 0 0 50px rgba(139, 92, 246, 0.3), inset 0 0 40px rgba(139, 92, 246, 0.1);
    }

    .upload-box.body-mode:hover {
      border-color: var(--success);
      box-shadow: 0 0 50px rgba(16, 185, 129, 0.3), inset 0 0 40px rgba(16, 185, 129, 0.1);
    }

    .upload-box.has-image {
      border-style: solid;
      border-color: var(--success);
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.3), inset 0 0 30px rgba(16, 185, 129, 0.1);
    }

    .upload-box input[type="file"] {
      display: none;
    }

    .upload-box-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      filter: drop-shadow(0 0 15px rgba(139, 92, 246, 0.6));
    }

    .upload-box h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .upload-box p {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .upload-box .required {
      color: var(--error);
      font-weight: 600;
    }

    .upload-box .optional {
      color: var(--text-muted);
      font-weight: 500;
    }

    .upload-preview {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 1rem;
    }

    .upload-remove {
      background: var(--error);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* Photo tips for body scan */
    .body-photo-tips {
      background: var(--surface);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .body-photo-tips h4 {
      color: var(--success);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .body-photo-tips ul {
      list-style: none;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    .body-photo-tips li {
      color: var(--text-secondary);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .body-photo-tips li::before {
      content: 'â€¢';
      color: var(--success);
    }

    .gender-selector {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .gender-btn {
      padding: 0.75rem 2rem;
      border-radius: 50px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      background: var(--surface);
      color: var(--text-secondary);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }

    .gender-btn.active {
      border-color: var(--primary);
      background: rgba(139, 92, 246, 0.2);
      color: var(--text);
      box-shadow: 0 0 25px rgba(139, 92, 246, 0.4);
    }

    /* Optional inputs for body scan */
    .optional-inputs {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .optional-input {
      background: var(--surface);
      border-radius: 12px;
      padding: 1rem;
    }

    .optional-input label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .optional-input input,
    .optional-input select {
      width: 100%;
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: var(--surface-light);
      color: var(--text);
      font-size: 1rem;
    }

    .optional-input input:focus,
    .optional-input select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .analyze-btn {
      width: 100%;
      padding: 1.25rem 2rem;
      font-size: 1.125rem;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--text);
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.5);
    }

    .analyze-btn.body-mode {
      background: linear-gradient(135deg, var(--accent-body), #059669);
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.5);
    }

    .analyze-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 0 60px rgba(139, 92, 246, 0.7), 0 10px 30px rgba(139, 92, 246, 0.4);
    }

    .analyze-btn.body-mode:hover:not(:disabled) {
      box-shadow: 0 0 60px rgba(16, 185, 129, 0.7), 0 10px 30px rgba(16, 185, 129, 0.4);
    }

    .analyze-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Loading State */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 10, 15, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--surface-light);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1.5rem;
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), inset 0 0 20px rgba(139, 92, 246, 0.2);
    }

    .loading-spinner.body-mode {
      border-top-color: var(--success);
      box-shadow: 0 0 30px rgba(16, 185, 129, 0.5), inset 0 0 20px rgba(16, 185, 129, 0.2);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    .loading-text {
      font-size: 1.25rem;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .loading-subtext {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    /* Results Section */
    .results-section {
      padding: 6rem 2rem;
      display: none;
    }

    .results-section.visible {
      display: block;
    }

    .results-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .results-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .results-header h2 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      text-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
    }

    .results-header.body-mode h2 {
      text-shadow: 0 0 30px rgba(16, 185, 129, 0.5);
    }

    .overall-score {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 3rem;
      background: linear-gradient(180deg, transparent, rgba(139, 92, 246, 0.03), transparent);
      padding: 2rem 0;
      position: relative;
    }

    .overall-score::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
      z-index: -1;
      opacity: 0;
      animation: bgGlowIn 2s ease forwards;
      animation-delay: 1s;
    }

    .overall-score.body-mode::before {
      background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 70%);
    }

    @keyframes bgGlowIn {
      to { opacity: 1; }
    }

    .dual-score-container {
      display: flex;
      align-items: center;
      gap: 2.5rem;
      margin-bottom: 2rem;
      padding: 2rem;
      position: relative;
    }

    .dual-score-container::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--surface-light), var(--primary), var(--success), var(--surface-light), transparent);
      opacity: 0;
      animation: connectorReveal 1s ease forwards;
      animation-delay: 2s;
      z-index: -1;
    }

    @keyframes connectorReveal {
      to { opacity: 0.5; }
    }

    .score-circle {
      width: 220px;
      height: 220px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      animation: scoreCircleReveal 1.5s ease-out forwards;
    }

    @keyframes scoreCircleReveal {
      0% {
        transform: scale(0.6) rotate(-180deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.1) rotate(360deg);
        opacity: 1;
      }
      100% {
        transform: scale(1) rotate(720deg);
        opacity: 1;
      }
    }

    .score-circle::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 50%;
      padding: 12px;
      background: conic-gradient(
        var(--score-color, var(--primary)) calc(var(--score-progress, 0) * 36deg),
        var(--surface-light) calc(var(--score-progress, 0) * 36deg)
      );
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      transition: all 0.1s ease-out;
    }

    .score-circle::after {
      content: '';
      position: absolute;
      inset: -15px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--score-color, var(--primary)) 0%, transparent 70%);
      opacity: 0;
      z-index: -1;
      animation: glowPulse 2s ease-in-out infinite;
      animation-delay: 2s;
    }

    @keyframes glowPulse {
      0%, 100% {
        opacity: 0.15;
        transform: scale(1);
      }
      50% {
        opacity: 0.35;
        transform: scale(1.15);
      }
    }

    .score-circle.potential {
      animation-delay: 0.3s;
    }

    .score-circle.potential::before {
      padding: 8px;
      opacity: 0.6;
    }

    .score-circle.potential::after {
      animation-delay: 2.3s;
    }

    .score-value {
      opacity: 0;
      animation: scoreValueReveal 0.8s ease-out forwards;
      animation-delay: 1.5s;
    }

    @keyframes scoreValueReveal {
      0% {
        opacity: 0;
        transform: scale(0.5);
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .score-circle.potential .score-value {
      animation-delay: 1.8s;
    }

    .score-label {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--text-muted);
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
      opacity: 0;
      animation: labelFadeIn 0.5s ease forwards;
      animation-delay: 1s;
    }

    @keyframes labelFadeIn {
      to { opacity: 1; }
    }

    .score-circle.potential .score-label {
      animation-delay: 1.3s;
    }

    .score-value {
      font-size: 4.5rem;
      font-weight: 800;
      color: var(--score-color, var(--primary));
      text-shadow: 0 0 30px var(--score-color, var(--primary));
      line-height: 1;
    }

    .score-max {
      font-size: 1.5rem;
      color: var(--text-muted);
      opacity: 0;
      animation: labelFadeIn 0.5s ease forwards;
      animation-delay: 1.7s;
    }

    .score-circle.potential .score-max {
      animation-delay: 2s;
    }

    .score-context {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      opacity: 0;
      animation: labelFadeIn 0.5s ease forwards;
      animation-delay: 2s;
    }

    .score-circle.potential .score-context {
      animation-delay: 2.3s;
    }

    /* Success particles */
    .score-particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: visible;
    }

    .particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      opacity: 0;
    }

    .score-circle .particle:nth-child(1) { top: 10%; left: 20%; animation: particleFloat1 2s ease-out forwards; animation-delay: 3.5s; }
    .score-circle .particle:nth-child(2) { top: 15%; right: 15%; animation: particleFloat2 2s ease-out forwards; animation-delay: 3.6s; }
    .score-circle .particle:nth-child(3) { bottom: 20%; left: 15%; animation: particleFloat3 2s ease-out forwards; animation-delay: 3.7s; }
    .score-circle .particle:nth-child(4) { bottom: 10%; right: 20%; animation: particleFloat4 2s ease-out forwards; animation-delay: 3.8s; }
    .score-circle .particle:nth-child(5) { top: 5%; left: 50%; animation: particleFloat5 2s ease-out forwards; animation-delay: 3.9s; }
    .score-circle .particle:nth-child(6) { bottom: 5%; left: 50%; animation: particleFloat6 2s ease-out forwards; animation-delay: 4s; }

    @keyframes particleFloat1 {
      0% { opacity: 0; transform: translate(0, 0) scale(0); }
      20% { opacity: 1; transform: translate(-15px, -10px) scale(1); }
      100% { opacity: 0; transform: translate(-30px, -40px) scale(0.5); }
    }
    @keyframes particleFloat2 {
      0% { opacity: 0; transform: translate(0, 0) scale(0); }
      20% { opacity: 1; transform: translate(15px, -10px) scale(1); }
      100% { opacity: 0; transform: translate(30px, -40px) scale(0.5); }
    }
    @keyframes particleFloat3 {
      0% { opacity: 0; transform: translate(0, 0) scale(0); }
      20% { opacity: 1; transform: translate(-15px, 10px) scale(1); }
      100% { opacity: 0; transform: translate(-30px, 40px) scale(0.5); }
    }
    @keyframes particleFloat4 {
      0% { opacity: 0; transform: translate(0, 0) scale(0); }
      20% { opacity: 1; transform: translate(15px, 10px) scale(1); }
      100% { opacity: 0; transform: translate(30px, 40px) scale(0.5); }
    }
    @keyframes particleFloat5 {
      0% { opacity: 0; transform: translate(-50%, 0) scale(0); }
      20% { opacity: 1; transform: translate(-50%, -15px) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50px) scale(0.5); }
    }
    @keyframes particleFloat6 {
      0% { opacity: 0; transform: translate(-50%, 0) scale(0); }
      20% { opacity: 1; transform: translate(-50%, 15px) scale(1); }
      100% { opacity: 0; transform: translate(-50%, 50px) scale(0.5); }
    }

    .score-circle.potential .particle:nth-child(1) { animation-delay: 3.8s; }
    .score-circle.potential .particle:nth-child(2) { animation-delay: 3.9s; }
    .score-circle.potential .particle:nth-child(3) { animation-delay: 4s; }
    .score-circle.potential .particle:nth-child(4) { animation-delay: 4.1s; }
    .score-circle.potential .particle:nth-child(5) { animation-delay: 4.2s; }
    .score-circle.potential .particle:nth-child(6) { animation-delay: 4.3s; }

    .potential-gain {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      opacity: 0;
      animation: gainBadgeReveal 0.8s ease forwards;
      animation-delay: 2.5s;
    }

    @keyframes gainBadgeReveal {
      0% {
        opacity: 0;
        transform: scale(0.5) translateY(20px);
      }
      50% {
        transform: scale(1.15) translateY(-5px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .gain-badge {
      background: rgba(16, 185, 129, 0.15);
      border: 2px solid rgba(16, 185, 129, 0.4);
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
      animation: gainGlow 2s ease-in-out infinite;
      animation-delay: 3s;
    }

    @keyframes gainGlow {
      0%, 100% {
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
      }
      50% {
        box-shadow: 0 0 35px rgba(16, 185, 129, 0.5);
      }
    }

    .gain-badge span {
      font-size: 2rem;
      font-weight: 800;
      color: var(--success);
      text-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
    }

    .gain-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .confidence-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: badgeFadeIn 0.5s ease forwards;
      animation-delay: 3s;
    }

    @keyframes badgeFadeIn {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .confidence-badge.high {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .confidence-badge.medium {
      background: rgba(99, 102, 241, 0.15);
      color: #818CF8;
      border: 1px solid rgba(99, 102, 241, 0.3);
    }

    .confidence-badge.low {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .confidence-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: dotPulse 1.5s ease-in-out infinite;
    }

    @keyframes dotPulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(0.7); opacity: 0.5; }
    }

    .score-summary {
      text-align: center;
      max-width: 600px;
      color: var(--text-secondary);
      line-height: 1.8;
      font-size: 1.05rem;
      opacity: 0;
      animation: summaryFadeIn 0.8s ease forwards;
      animation-delay: 3.2s;
    }

    @keyframes summaryFadeIn {
      0% {
        opacity: 0;
        transform: translateY(15px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .calibration-note {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      background: var(--surface);
      padding: 1rem 1.25rem;
      border-radius: 12px;
      margin-top: 1.5rem;
      max-width: 550px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      opacity: 0;
      animation: calibrationFadeIn 0.6s ease forwards;
      animation-delay: 3.5s;
    }

    @keyframes calibrationFadeIn {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .calibration-note span {
      font-size: 0.9rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .calibration-note span:first-child {
      font-size: 1.1rem;
    }

    /* ============================
       BEST VERSION GENERATOR STYLES
       ============================ */
    
    .best-version-cta {
      margin-top: 2.5rem;
      margin-bottom: 1.5rem;
      cursor: pointer;
      opacity: 0;
      animation: bestVersionFadeIn 0.8s ease forwards;
      animation-delay: 1s;
      width: 100%;
      max-width: 100%;
    }

    @keyframes bestVersionFadeIn {
      0% { opacity: 0; transform: translateY(15px) scale(0.98); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .best-version-inner {
      position: relative;
      display: flex;
      align-items: center;
      gap: 1.25rem;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.25) 0%, rgba(6, 182, 212, 0.15) 100%);
      border: 2px solid rgba(139, 92, 246, 0.5);
      border-radius: 20px;
      padding: 1.5rem 2rem;
      width: 100%;
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .best-version-inner:hover {
      transform: translateY(-3px);
      border-color: rgba(139, 92, 246, 0.8);
      box-shadow: 0 12px 40px rgba(139, 92, 246, 0.35), 0 0 60px rgba(139, 92, 246, 0.15);
    }

    .best-version-glow {
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, rgba(139, 92, 246, 0.2) 0%, transparent 60%);
      animation: bestVersionPulse 3s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes bestVersionPulse {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }

    .best-version-icon {
      font-size: 2.5rem;
      filter: drop-shadow(0 0 12px rgba(139, 92, 246, 0.8));
      animation: iconSparkle 2s ease-in-out infinite;
      flex-shrink: 0;
    }

    @keyframes iconSparkle {
      0%, 100% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.15) rotate(5deg); }
    }

    .best-version-content {
      flex: 1;
      z-index: 1;
    }

    .best-version-content h4 {
      font-size: 1.35rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.35rem;
      text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    .best-version-content p {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin: 0;
      line-height: 1.5;
    }

    .best-version-arrow {
      font-size: 2rem;
      color: var(--primary);
      z-index: 1;
      transition: transform 0.3s ease;
      flex-shrink: 0;
    }

    .best-version-inner:hover .best-version-arrow {
      transform: translateX(8px);
    }

    /* Best Version Modal */
    .best-version-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10000;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .best-version-modal.active {
      display: flex;
      animation: modalFadeIn 0.3s ease;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .best-version-modal-backdrop {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
    }

    .best-version-modal-content {
      position: relative;
      background: var(--surface);
      border-radius: 24px;
      padding: 2rem;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
      animation: modalSlideUp 0.4s ease;
    }

    @keyframes modalSlideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .best-version-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--surface-light);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      z-index: 10;
    }

    .best-version-close:hover {
      background: var(--error);
      border-color: var(--error);
    }

    /* Loading State */
    .best-version-loading {
      text-align: center;
      padding: 2rem 0;
    }

    .best-version-loading-image {
      width: 220px;
      height: 220px;
      border-radius: 20px;
      background: var(--surface-light);
      margin: 0 auto 1.5rem;
      background-size: cover;
      background-position: center;
      filter: blur(4px);
      animation: loadingPulse 2s ease-in-out infinite;
    }

    @keyframes loadingPulse {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.02); }
    }

    .best-version-loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid var(--surface-light);
      border-top-color: var(--primary);
      border-radius: 50%;
      margin: 0 auto 1.5rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .best-version-loading h3 {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .best-version-loading-text {
      color: var(--primary);
      font-size: 1rem;
    }

    .best-version-progress {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      margin-top: 1.5rem;
    }

    .best-version-progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--surface-light);
      transition: background 0.3s;
    }

    .best-version-progress-dot.active {
      background: var(--primary);
    }

    /* Results State */
    .best-version-results h3 {
      text-align: center;
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 1.5rem;
    }

    .best-version-toggle {
      display: flex;
      background: var(--background);
      border-radius: 14px;
      padding: 5px;
      margin-bottom: 1.5rem;
    }

    .best-version-toggle-btn {
      flex: 1;
      padding: 0.85rem 1rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      border-radius: 10px;
      transition: all 0.3s;
    }

    .best-version-toggle-btn.active {
      background: var(--primary);
      color: var(--text);
    }

    .best-version-image-container {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .best-version-image-container img {
      width: 100%;
      border-radius: 20px;
      display: block;
    }

    .best-version-badge {
      position: absolute;
      bottom: 14px;
      right: 14px;
      background: rgba(0, 0, 0, 0.85);
      color: #fbbf24;
      padding: 0.6rem 1.2rem;
      border-radius: 24px;
      font-size: 0.9rem;
      font-weight: 600;
      border: 1px solid rgba(251, 191, 36, 0.4);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .best-version-badge::before {
      content: 'âœ¨';
    }

    .best-version-fallback-notice {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: rgba(245, 158, 11, 0.15);
      border: 1px solid rgba(245, 158, 11, 0.35);
      border-radius: 14px;
      padding: 1rem 1.25rem;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
      color: var(--warning);
    }

    .best-version-changes {
      background: var(--background);
      border-radius: 18px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .best-version-changes h4 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 1.25rem;
    }

    .best-version-changes-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .best-version-change-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }

    .best-version-change-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(139, 92, 246, 0.25);
      color: var(--primary);
      font-size: 0.85rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .best-version-change-text {
      color: var(--text-secondary);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .best-version-retry {
      width: 100%;
      padding: 1.1rem;
      background: var(--surface-light);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 14px;
      color: var(--text);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .best-version-retry::before {
      content: 'ðŸ”„';
    }

    .best-version-retry:hover {
      background: var(--primary);
      border-color: var(--primary);
    }

    /* Mobile Responsive */
    @media (max-width: 600px) {
      .best-version-inner {
        padding: 1.25rem 1.5rem;
        gap: 1rem;
        border-radius: 16px;
        flex-direction: row;
      }
      
      .best-version-icon {
        font-size: 2rem;
      }
      
      .best-version-content h4 {
        font-size: 1.15rem;
      }
      
      .best-version-content p {
        font-size: 0.85rem;
      }
      
      .best-version-arrow {
        font-size: 1.5rem;
      }
      
      .best-version-modal-content {
        padding: 1.5rem;
        border-radius: 20px;
      }
      
      .best-version-loading-image {
        width: 180px;
        height: 180px;
      }
    }

    /* Photo Quality Warnings */
    .photo-quality-box {
      background: var(--surface);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 2rem;
      border-left: 3px solid var(--warning);
    }

    .photo-quality-box.good {
      border-left-color: var(--success);
    }

    .photo-quality-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .photo-quality-title {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .photo-quality-issues {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .photo-issue-tag {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      padding: 0.25rem 0.75rem;
      border-radius: 50px;
      font-size: 0.75rem;
    }

    /* Top 3 Levers Section */
    .top-levers {
      background: var(--surface);
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(16, 185, 129, 0.3);
      margin-bottom: 2rem;
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.15), inset 0 0 40px rgba(16, 185, 129, 0.05);
    }

    .top-levers-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1.5rem;
    }

    .top-levers h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
    }

    .top-levers h3 span {
      font-size: 0.9rem;
      color: var(--text-muted);
      font-weight: 400;
    }

    .total-gain-badge {
      background: rgba(16, 185, 129, 0.15);
      padding: 0.5rem 1rem;
      border-radius: 12px;
      text-align: center;
      border: 1px solid rgba(16, 185, 129, 0.4);
      box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
    }

    .total-gain-value {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--success);
      display: block;
      text-shadow: 0 0 15px rgba(16, 185, 129, 0.8);
    }

    .total-gain-label {
      font-size: 0.7rem;
      color: var(--success);
    }

    .lever-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--surface-light);
      border-radius: 12px;
      margin-bottom: 0.75rem;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s;
    }

    .lever-item:hover {
      border-color: rgba(16, 185, 129, 0.3);
      box-shadow: 0 0 25px rgba(16, 185, 129, 0.15);
    }

    .lever-priority {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .lever-priority.p1 { background: var(--success); box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); }
    .lever-priority.p2 { background: var(--warning); box-shadow: 0 0 20px rgba(245, 158, 11, 0.6); }
    .lever-priority.p3 { background: var(--primary); box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); }

    .lever-content {
      flex: 1;
    }

    .lever-name {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }

    .lever-meta {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .lever-delta {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      padding: 0.15rem 0.5rem;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.85rem;
      box-shadow: 0 0 12px rgba(16, 185, 129, 0.4);
      text-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
    }

    .lever-timeline {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .lever-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      border-radius: 1.5px;
    }

    .timeline-note {
      text-align: center;
      padding-top: 1rem;
      border-top: 1px solid rgba(255,255,255,0.05);
      margin-top: 0.5rem;
    }

    .timeline-note span {
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    .timeline-note strong {
      color: var(--primary);
    }

    .features-results {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    /* Expandable Feature Cards */
    .feature-result-card {
      background: var(--surface);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      overflow: hidden;
      cursor: pointer;
    }

    .feature-result-card:hover {
      border-color: rgba(139, 92, 246, 0.3);
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.15);
    }

    .feature-result-card.body-mode:hover {
      border-color: rgba(16, 185, 129, 0.3);
      box-shadow: 0 0 30px rgba(16, 185, 129, 0.15);
    }

    .feature-result-card.expanded {
      border-color: rgba(139, 92, 246, 0.4);
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.2);
    }

    .feature-result-card.body-mode.expanded {
      border-color: rgba(16, 185, 129, 0.4);
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.2);
    }

    .feature-collapsed {
      padding: 1.25rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .feature-result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex: 1;
    }

    .feature-result-name {
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .feature-result-score {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--primary);
    }

    .feature-result-card.body-mode .feature-result-score {
      color: var(--success);
    }

    .feature-expand-icon {
      font-size: 1.2rem;
      color: var(--text-muted);
      transition: transform 0.3s ease;
    }

    .feature-result-card.expanded .feature-expand-icon {
      transform: rotate(180deg);
    }

    .feature-result-bar {
      height: 6px;
      background: var(--surface-light);
      border-radius: 3px;
      overflow: hidden;
      margin: 0 1.5rem 0.5rem;
    }

    .feature-result-fill {
      height: 100%;
      border-radius: 3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
      transition: width 0.5s ease;
    }

    .feature-result-card.body-mode .feature-result-fill {
      background: linear-gradient(90deg, var(--success), var(--accent));
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
    }

    /* Expanded Content */
    .feature-expanded-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.3s ease;
      padding: 0 1.5rem;
    }

    .feature-result-card.expanded .feature-expanded-content {
      max-height: 1500px;
      padding: 1rem 1.5rem 1.5rem;
    }

    .feature-section {
      margin-bottom: 1.25rem;
    }

    .feature-section:last-child {
      margin-bottom: 0;
    }

    .feature-section-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .feature-evidence {
      background: var(--surface-light);
      padding: 1rem;
      border-radius: 10px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.6;
      border-left: 3px solid var(--primary);
    }

    .feature-result-card.body-mode .feature-evidence {
      border-left-color: var(--success);
    }

    .feature-strengths-list, .feature-limits-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .feature-strengths-list li {
      padding: 0.5rem 0;
      font-size: 0.9rem;
      color: var(--success);
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    }

    .feature-strengths-list li:last-child {
      border-bottom: none;
    }

    .feature-limits-list li {
      padding: 0.5rem 0;
      font-size: 0.9rem;
      color: var(--warning);
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    }

    .feature-limits-list li:last-child {
      border-bottom: none;
    }

    /* Fixes/Actions */
    .feature-fixes {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .feature-fix-item {
      background: var(--surface-light);
      border-radius: 10px;
      padding: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.2s ease;
    }

    .feature-fix-item:hover {
      border-color: rgba(139, 92, 246, 0.2);
    }

    .feature-fix-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .feature-fix-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .feature-fix-delta {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
      padding: 0.25rem 0.6rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .feature-fix-meta {
      display: flex;
      gap: 1rem;
      margin-bottom: 0.75rem;
      font-size: 0.8rem;
    }

    .feature-fix-meta span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      color: var(--text-muted);
    }

    .feature-fix-steps {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .feature-fix-steps li {
      padding: 0.35rem 0;
      font-size: 0.85rem;
      color: var(--text-secondary);
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .feature-fix-steps li::before {
      content: 'â€¢';
      color: var(--primary);
      font-weight: bold;
    }

    /* Product Recommendations Button */
    .feature-recommend-btn {
      width: 100%;
      padding: 0.9rem 1rem;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(139, 92, 246, 0.05));
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 10px;
      color: var(--primary);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .feature-recommend-btn:hover {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.25), rgba(139, 92, 246, 0.1));
      border-color: rgba(139, 92, 246, 0.5);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
    }

    .feature-result-card.body-mode .feature-recommend-btn {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
      border-color: rgba(16, 185, 129, 0.3);
      color: var(--success);
    }

    .feature-result-card.body-mode .feature-recommend-btn:hover {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(16, 185, 129, 0.1));
      border-color: rgba(16, 185, 129, 0.5);
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
    }

    /* Recommendations Modal */
    .recommend-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .recommend-modal.active {
      display: flex;
      animation: modalFadeIn 0.3s ease;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .recommend-modal-content {
      background: var(--surface);
      border-radius: 20px;
      max-width: 600px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      border: 1px solid rgba(139, 92, 246, 0.3);
      box-shadow: 0 0 60px rgba(139, 92, 246, 0.3);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .recommend-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .recommend-modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .recommend-modal-close {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--surface-light);
      border: none;
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .recommend-modal-close:hover {
      background: rgba(239, 68, 68, 0.2);
      color: #EF4444;
    }

    .recommend-modal-body {
      padding: 1.5rem;
    }

    .recommend-loading {
      text-align: center;
      padding: 3rem;
    }

    .recommend-loading .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid var(--surface-light);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    .recommend-product-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .recommend-product {
      background: var(--surface-light);
      border-radius: 12px;
      padding: 1.25rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .recommend-product-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .recommend-product-name {
      font-weight: 600;
      font-size: 1rem;
      color: var(--text);
    }

    .recommend-product-type {
      font-size: 0.75rem;
      color: var(--primary);
      background: rgba(139, 92, 246, 0.15);
      padding: 0.2rem 0.6rem;
      border-radius: 20px;
    }

    .recommend-product-desc {
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 0.75rem;
    }

    .recommend-product-tips {
      font-size: 0.85rem;
      color: var(--text-muted);
      font-style: italic;
    }

    .recommend-disclaimer {
      background: rgba(245, 158, 11, 0.1);
      border-left: 3px solid var(--warning);
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .feature-confidence-badge {
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 20px;
      font-weight: 500;
    }

    .feature-confidence-badge.high {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
    }

    .feature-confidence-badge.medium {
      background: rgba(99, 102, 241, 0.15);
      color: #818CF8;
    }

    .feature-confidence-badge.low {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
    }

    .feature-result-notes {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .feature-result-notes li {
      margin-bottom: 0.25rem;
    }

    .top-fixes {
      background: var(--surface);
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(139, 92, 246, 0.3);
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.15), inset 0 0 40px rgba(139, 92, 246, 0.05);
    }

    .top-fixes.body-mode {
      border-color: rgba(16, 185, 129, 0.3);
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.15), inset 0 0 40px rgba(16, 185, 129, 0.05);
    }

    .top-fixes h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
    }

    .fix-item {
      padding: 1.25rem;
      background: var(--surface-light);
      border-radius: 12px;
      margin-bottom: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s;
    }

    .fix-item:hover {
      border-color: rgba(139, 92, 246, 0.3);
      box-shadow: 0 0 25px rgba(139, 92, 246, 0.15);
    }

    .fix-item:last-child {
      margin-bottom: 0;
    }

    .fix-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .fix-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .fix-impact {
      font-size: 0.75rem;
      padding: 0.25rem 0.75rem;
      border-radius: 50px;
      font-weight: 600;
    }

    .fix-impact.high {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
    }

    .fix-impact.medium {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
      box-shadow: 0 0 15px rgba(245, 158, 11, 0.4);
    }

    .fix-why {
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-bottom: 0.75rem;
    }

    .fix-steps {
      font-size: 0.875rem;
      color: var(--text-muted);
      padding-left: 1rem;
    }

    .fix-steps li {
      margin-bottom: 0.25rem;
    }

    .new-scan-btn {
      width: 100%;
      margin-top: 2rem;
      padding: 1rem 2rem;
      background: var(--surface-light);
      border: 2px solid rgba(139, 92, 246, 0.4);
      color: var(--text);
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
    }

    .new-scan-btn:hover {
      border-color: var(--primary);
      background: rgba(139, 92, 246, 0.1);
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.4);
    }

    /* Features Section */
    .features {
      padding: 2rem 2rem 6rem;
      position: relative;
      min-height: calc(100vh - 80px);
    }

    .section-header {
      text-align: center;
      max-width: 700px;
      margin: 0 auto 4rem;
    }

    .section-label {
      display: inline-block;
      color: var(--primary);
      font-weight: 600;
      font-size: 0.875rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 1rem;
      text-shadow: 0 0 20px rgba(139, 92, 246, 0.6);
    }

    .section-title {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 1rem;
      text-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
    }

    .section-description {
      color: var(--text-secondary);
      font-size: 1.125rem;
    }

    .features-grid {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }

    .section-cta {
      text-align: center;
      margin-top: 4rem;
    }

    .feature-card {
      background: linear-gradient(145deg, var(--surface), var(--surface-light));
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }

    .feature-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.8);
    }

    .feature-card:hover {
      transform: translateY(-5px);
      border-color: rgba(139, 92, 246, 0.4);
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.2), 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .feature-card:hover::before {
      opacity: 1;
    }

    .feature-card-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      background: rgba(139, 92, 246, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 0 25px rgba(139, 92, 246, 0.3);
    }

    .feature-card h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .feature-card p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    /* How it works */
    .how-it-works {
      padding: 2rem 2rem 6rem;
      background: linear-gradient(180deg, transparent, rgba(139, 92, 246, 0.03), transparent);
      min-height: calc(100vh - 80px);
    }

    .steps {
      max-width: 1000px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 3rem;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 3rem;
    }

    .step:nth-child(even) {
      flex-direction: row-reverse;
    }

    .step-number {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: 800;
      flex-shrink: 0;
      box-shadow: 0 0 50px rgba(139, 92, 246, 0.5), 0 0 100px rgba(139, 92, 246, 0.3), 0 10px 40px rgba(139, 92, 246, 0.3);
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .step-content {
      flex: 1;
    }

    .step-content h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .step-content p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    /* Footer */
    footer {
      padding: 3rem 2rem;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      text-align: center;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
    }

    .footer-logo {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    .footer-logo span {
      filter: drop-shadow(0 0 8px rgba(139, 92, 246, 0.6));
    }

    .footer-text {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    /* Hide sections */
    .hidden {
      display: none !important;
    }

    /* ====== DELTA BREAKDOWN SECTION ====== */
    .delta-breakdown {
      background: var(--surface);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .delta-breakdown h4 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .delta-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .delta-item:last-child {
      border-bottom: none;
    }

    .delta-label {
      flex: 0 0 120px;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .delta-bar-container {
      flex: 1;
      height: 8px;
      background: var(--surface-light);
      border-radius: 4px;
      overflow: hidden;
    }

    .delta-bar {
      height: 100%;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--success), #34d399);
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
      transition: width 1s ease-out;
    }

    .delta-value {
      flex: 0 0 50px;
      text-align: right;
      font-weight: 700;
      color: var(--success);
      font-size: 0.95rem;
    }

    /* ====== 14-DAY ACTION PLAN ====== */
    .action-plan {
      background: linear-gradient(135deg, var(--surface), rgba(139, 92, 246, 0.1));
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(139, 92, 246, 0.3);
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.15);
    }

    .action-plan-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1.5rem;
    }

    .action-plan h3 {
      font-size: 1.25rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .action-plan h3 span {
      font-size: 0.9rem;
      color: var(--text-muted);
      font-weight: 400;
    }

    .streak-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(245, 158, 11, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 50px;
      border: 1px solid rgba(245, 158, 11, 0.4);
    }

    .streak-badge .fire {
      font-size: 1.2rem;
    }

    .streak-count {
      font-weight: 800;
      color: var(--warning);
      font-size: 1.1rem;
    }

    .streak-label {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .day-selector {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .day-btn {
      flex: 0 0 auto;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--surface-light);
      background: var(--surface);
      color: var(--text-muted);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day-btn.completed {
      background: var(--success);
      border-color: var(--success);
      color: var(--text);
    }

    .day-btn.current {
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
      color: var(--primary);
    }

    .day-btn:hover {
      border-color: var(--primary);
    }

    .daily-checklist {
      background: var(--surface-light);
      border-radius: 12px;
      padding: 1rem;
    }

    .checklist-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .checklist-header h4 {
      font-size: 1rem;
      font-weight: 600;
    }

    .checklist-progress {
      font-size: 0.85rem;
      color: var(--success);
      font-weight: 600;
    }

    .checklist-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--surface);
      border-radius: 8px;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .checklist-item:hover {
      border-color: rgba(139, 92, 246, 0.3);
    }

    .checklist-item.completed {
      opacity: 0.7;
    }

    .checklist-item.completed .checklist-text {
      text-decoration: line-through;
    }

    .checklist-checkbox {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--surface-light);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .checklist-item.completed .checklist-checkbox {
      background: var(--success);
      border-color: var(--success);
    }

    .checklist-text {
      flex: 1;
      font-size: 0.95rem;
    }

    .checklist-category {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      background: rgba(139, 92, 246, 0.2);
      color: var(--primary-light);
    }

    /* ====== STYLE ENGINE ====== */
    .style-engine {
      background: var(--surface);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(6, 182, 212, 0.3);
      box-shadow: 0 0 40px rgba(6, 182, 212, 0.1);
    }

    .style-engine h3 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .style-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .style-tab {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: 1px solid var(--surface-light);
      background: transparent;
      color: var(--text-secondary);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .style-tab.active {
      background: var(--primary);
      border-color: var(--primary);
      color: var(--text);
    }

    .style-tab:hover:not(.active) {
      border-color: var(--primary);
    }

    .style-content {
      display: none;
    }

    .style-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .style-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .style-card {
      background: var(--surface-light);
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.2s;
    }

    .style-card:hover {
      border-color: rgba(6, 182, 212, 0.3);
      box-shadow: 0 0 20px rgba(6, 182, 212, 0.1);
    }

    .style-card-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .style-card-icon {
      font-size: 1.25rem;
    }

    .style-card h4 {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .style-card p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .style-card .match-score {
      display: inline-block;
      margin-top: 0.5rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .style-card .match-score.high {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .style-card .match-score.medium {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .skin-routine {
      background: var(--surface-light);
      border-radius: 12px;
      padding: 1rem;
    }

    .routine-time {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--accent);
    }

    .routine-steps {
      list-style: none;
    }

    .routine-steps li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0;
      font-size: 0.9rem;
      color: var(--text-secondary);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .routine-steps li:last-child {
      border-bottom: none;
    }

    .routine-steps li::before {
      content: attr(data-step);
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--surface);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
    }

    /* ====== PROGRESS PHOTOS ====== */
    .progress-section {
      background: var(--surface);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .progress-header h3 {
      font-size: 1.25rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .save-progress-btn {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: var(--primary);
      border: none;
      color: var(--text);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .save-progress-btn:hover {
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    .progress-empty {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted);
    }

    .progress-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
    }

    .progress-item {
      background: var(--surface-light);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .progress-item:hover {
      transform: scale(1.02);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
    }

    .progress-item img {
      width: 100%;
      aspect-ratio: 3/4;
      object-fit: cover;
    }

    .progress-item-info {
      padding: 0.75rem;
    }

    .progress-item-date {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .progress-item-score {
      font-size: 1rem;
      font-weight: 700;
      color: var(--primary);
    }

    .compare-mode {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .compare-mode h4 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .compare-slider-container {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      aspect-ratio: 4/3;
      background: var(--surface-light);
    }

    .compare-slider-container img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .compare-slider-container .after-image {
      clip-path: inset(0 50% 0 0);
    }

    .compare-slider {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      width: 4px;
      background: var(--primary);
      cursor: ew-resize;
      z-index: 10;
    }

    .compare-slider::before {
      content: 'âŸ·';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
      font-size: 1rem;
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    .compare-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 0.75rem;
    }

    .compare-labels span {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    /* ====== RETAKE GUIDANCE ====== */
    .retake-guidance {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .retake-guidance h4 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--warning);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .retake-tips {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .retake-tip {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .retake-tip-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(245, 158, 11, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .retake-btn {
      width: 100%;
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      background: var(--warning);
      border: none;
      color: var(--background);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .retake-btn:hover {
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
    }

    /* ====== WEEKLY RECAP ====== */
    .weekly-recap {
      background: linear-gradient(135deg, var(--surface), rgba(16, 185, 129, 0.1));
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .weekly-recap h4 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .recap-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .recap-stat {
      text-align: center;
      padding: 1rem;
      background: var(--surface);
      border-radius: 12px;
    }

    .recap-stat-value {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--success);
    }

    .recap-stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* Results page tabs */
    .results-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      background: var(--surface);
      padding: 0.5rem;
      border-radius: 12px;
    }

    .results-tab {
      flex: 1;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .results-tab.active {
      background: var(--primary);
      color: var(--text);
    }

    .results-tab:hover:not(.active) {
      background: var(--surface-light);
    }

    .results-tab-content {
      display: none;
    }

    .results-tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    /* Mobile Responsiveness */
    @media (max-width: 968px) {
      .hero-container {
        grid-template-columns: 1fr;
        text-align: center;
      }

      .hero h1 {
        font-size: 2.5rem;
      }

      .hero-description {
        margin: 0 auto 2rem;
      }

      .hero-buttons {
        justify-content: center;
      }

      .features-grid {
        grid-template-columns: 1fr;
        max-width: 500px;
      }

      .step {
        flex-direction: column !important;
        text-align: center;
      }

      .upload-grid {
        grid-template-columns: 1fr;
      }

      .features-results {
        grid-template-columns: 1fr;
      }

      .nav-links {
        display: none;
      }

      .dual-score-container {
        flex-direction: column;
        gap: 2rem;
      }

      .score-circle {
        width: 200px;
        height: 200px;
      }

      .score-value {
        font-size: 3.5rem;
      }

      .scan-cards {
        grid-template-columns: 1fr;
      }

      .optional-inputs {
        grid-template-columns: 1fr 1fr;
      }

      .body-photo-tips ul {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .hero h1 {
        font-size: 2rem;
      }

      .section-title {
        font-size: 2rem;
      }

      .phone-mockup {
        width: 260px;
        height: 530px;
      }

      .score-circle {
        width: 170px;
        height: 170px;
      }

      .score-value {
        font-size: 3rem;
      }

      .score-circle::before {
        padding: 10px;
      }

      .gain-badge span {
        font-size: 1.5rem;
      }

      .optional-inputs {
        grid-template-columns: 1fr;
      }

      /* New features mobile */
      .results-tabs {
        flex-wrap: wrap;
      }

      .results-tab {
        flex: 1 1 45%;
        font-size: 0.8rem;
        padding: 0.5rem;
      }

      .style-tabs {
        flex-wrap: wrap;
      }

      .style-tab {
        flex: 1 1 30%;
        font-size: 0.75rem;
        padding: 0.4rem 0.6rem;
      }

      .style-grid {
        grid-template-columns: 1fr;
      }

      .delta-label {
        flex: 0 0 80px;
        font-size: 0.8rem;
      }

      .recap-stats {
        grid-template-columns: 1fr;
      }

      .retake-tips {
        grid-template-columns: 1fr;
      }

      .day-selector {
        justify-content: flex-start;
      }

      .day-btn {
        width: 35px;
        height: 35px;
        font-size: 0.75rem;
      }

      .action-plan-header {
        flex-direction: column;
        gap: 1rem;
      }

      .progress-gallery {
        grid-template-columns: repeat(2, 1fr);
      }

      .appearance-grid {
        grid-template-columns: 1fr;
      }

      .harmony-components {
        grid-template-columns: 1fr;
      }
    }

    /* Hide old gender selector styles - no longer used */
    .gender-selector {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="bg-gradient"></div>

  <nav>
    <div class="nav-container">
      <a href="#" class="logo">
        <span class="logo-icon">âœ¨</span>
        LifeMAX
      </a>
      <ul class="nav-links">
        <li><a href="#" data-page="home" class="active">Home</a></li>
        <li><a href="#" data-page="features">Features</a></li>
        <li><a href="#" data-page="how-it-works">How it Works</a></li>
      </ul>
      <div class="scan-dropdown">
        <button class="scan-dropdown-btn">
          Start Scan â–¾
        </button>
        <div class="scan-dropdown-content">
          <a href="#" class="scan-option" data-page="analyze" data-scan-type="face">
            <div class="scan-option-icon face">ðŸ˜Š</div>
            <div class="scan-option-text">
              <div class="scan-option-title">Face Scan</div>
              <div class="scan-option-desc">Facial aesthetics analysis</div>
            </div>
          </a>
          <a href="#" class="scan-option" data-page="analyze" data-scan-type="body">
            <div class="scan-option-icon body">ðŸ‹ï¸</div>
            <div class="scan-option-text">
              <div class="scan-option-title">Body Scan</div>
              <div class="scan-option-desc">Physique & posture analysis</div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- HOME PAGE -->
  <div class="page-section active" id="page-home">
  <section class="hero">
    <div class="hero-container">
      <div class="hero-content">
        <div class="hero-badge">
          <span>âœ¨</span> AI-Powered Analysis
        </div>
        <h1>Discover Your <span class="highlight">True Potential</span></h1>
        <p class="hero-description">
          See your current self. Unlock your potential.
        </p>
        <div class="hero-buttons">
          <a href="#" data-page="analyze" data-scan-type="face" class="btn btn-primary">
            ðŸ˜Š Face Scan â†’
          </a>
          <a href="#" data-page="analyze" data-scan-type="body" class="btn btn-body">
            ðŸ‹ï¸ Body Scan â†’
          </a>
          <a href="#" data-page="how-it-works" class="btn btn-secondary">
            Learn More
          </a>
        </div>
      </div>
      <div class="hero-visual">
        <div class="phone-mockup">
          <div class="phone-screen">
            <div class="phone-notch"></div>
            <div class="screen-content">
              <div style="text-align: center; margin-bottom: 8px;">
                <span style="font-size: 0.65rem; color: var(--text-muted); letter-spacing: 1px;">CURRENT â†’ POTENTIAL</span>
              </div>
              <div class="rating-circle">
                <div class="rating-inner">
                  <span class="rating-value" style="font-size: 2rem;">5.4</span>
                  <span style="font-size: 1.5rem; color: var(--success); margin: 0 4px;">â†’</span>
                  <span class="rating-value" style="font-size: 2rem; color: var(--success);">6.8</span>
                </div>
              </div>
              <div style="text-align: center; margin-bottom: 12px;">
                <span style="background: rgba(16, 185, 129, 0.2); color: var(--success); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">+1.4 possible</span>
              </div>
              <div class="feature-bars">
                <div class="feature-bar">
                  <span class="feature-icon">âœ¨</span>
                  <div class="feature-track">
                    <div class="feature-fill" style="--width: 52%; --delay: 0; background: linear-gradient(90deg, var(--warning), #fbbf24);"></div>
                  </div>
                  <span class="feature-score">5.2</span>
                </div>
                <div class="feature-bar">
                  <span class="feature-icon">ðŸ‘ï¸</span>
                  <div class="feature-track">
                    <div class="feature-fill" style="--width: 58%; --delay: 1; background: linear-gradient(90deg, var(--warning), #fbbf24);"></div>
                  </div>
                  <span class="feature-score">5.8</span>
                </div>
                <div class="feature-bar">
                  <span class="feature-icon">ðŸ’Ž</span>
                  <div class="feature-track">
                    <div class="feature-fill" style="--width: 64%; --delay: 2; background: linear-gradient(90deg, var(--success), #34d399);"></div>
                  </div>
                  <span class="feature-score">6.4</span>
                </div>
                <div class="feature-bar">
                  <span class="feature-icon">ðŸ’ª</span>
                  <div class="feature-track">
                    <div class="feature-fill" style="--width: 61%; --delay: 3; background: linear-gradient(90deg, var(--success), #34d399);"></div>
                  </div>
                  <span class="feature-score">6.1</span>
                </div>
                <div class="feature-bar">
                  <span class="feature-icon">ðŸ‹ï¸</span>
                  <div class="feature-track">
                    <div class="feature-fill" style="--width: 50%; --delay: 4; background: linear-gradient(90deg, var(--warning), #fbbf24);"></div>
                  </div>
                  <span class="feature-score">5.0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Scan Type Selector -->
  <section class="scan-selector-section">
    <div class="scan-selector-container">
      <div class="scan-selector-header">
        <h2>Choose Your Analysis</h2>
        <p>Get personalized insights and actionable improvement plans</p>
      </div>
      <div class="scan-cards">
        <div class="scan-card face" data-page="analyze" data-scan-type="face">
          <div class="scan-card-icon">ðŸ˜Š</div>
          <h3>Face Analyzer</h3>
          <p>Detailed facial aesthetics analysis with feature breakdowns and grooming tips.</p>
          <ul class="scan-card-features">
            <li>Overall rating /10</li>
            <li>Feature breakdown (eyes, jaw, skin...)</li>
            <li>Top 3 improvement levers</li>
            <li>Actionable fixes with timelines</li>
          </ul>
        </div>
        <div class="scan-card body" data-page="analyze" data-scan-type="body">
          <div class="scan-card-icon">ðŸ‹ï¸</div>
          <h3>Body Analyzer</h3>
          <p>Physique analysis with posture assessment and workout recommendations.</p>
          <ul class="scan-card-features">
            <li>Overall physique rating /10</li>
            <li>V-taper, leanness, posture</li>
            <li>Muscle balance assessment</li>
            <li>Workout & nutrition plan</li>
          </ul>
        </div>
      </div>
    </div>
  </section>
  </div>

  <!-- FEATURES PAGE -->
  <div class="page-section" id="page-features">
  <section class="features" id="features">
    <div class="section-header">
      <span class="section-label">Features</span>
      <h2 class="section-title">Complete Aesthetics Analysis</h2>
      <p class="section-description">
        Powered by advanced AI to give you accurate, actionable insights about your face and body.
      </p>
    </div>
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-card-icon">ðŸ“Š</div>
        <h3>Honest Scoring</h3>
        <p>Realistic calibration where 5.5 is average. No score inflation â€“ most people land 4.5-6.5, and that's normal.</p>
      </div>
      <div class="feature-card">
        <div class="feature-card-icon">ðŸŽ¯</div>
        <h3>Current vs Potential</h3>
        <p>See where you are now AND your realistic full potential with specific improvement deltas.</p>
      </div>
      <div class="feature-card">
        <div class="feature-card-icon">ðŸ”</div>
        <h3>Top 3 Levers</h3>
        <p>Your highest-impact improvements ranked by delta, with realistic timelines (2-12 weeks).</p>
      </div>
      <div class="feature-card">
        <div class="feature-card-icon">ðŸ˜Š</div>
        <h3>Face Analysis</h3>
        <p>Detailed breakdown of eyes, nose, lips, jawline, skin quality, and facial harmony.</p>
      </div>
      <div class="feature-card">
        <div class="feature-card-icon">ðŸ‹ï¸</div>
        <h3>Body Analysis</h3>
        <p>V-taper ratio, posture assessment, muscle balance, and core presentation evaluation.</p>
      </div>
      <div class="feature-card">
        <div class="feature-card-icon">ðŸ”’</div>
        <h3>Privacy First</h3>
        <p>Your photos are analyzed securely and never stored. Complete privacy guaranteed.</p>
      </div>
    </div>
    <div class="section-cta">
      <a href="#" data-page="analyze" data-scan-type="face" class="btn btn-primary">Try Face Scan â†’</a>
      <a href="#" data-page="analyze" data-scan-type="body" class="btn btn-body" style="margin-left: 1rem;">Try Body Scan â†’</a>
    </div>
  </section>
  </div>

  <!-- HOW IT WORKS PAGE -->
  <div class="page-section" id="page-how-it-works">
  <section class="how-it-works" id="how-it-works">
    <div class="section-header">
      <span class="section-label">How It Works</span>
      <h2 class="section-title">Three Simple Steps</h2>
      <p class="section-description">
        Get your personalized analysis in under 60 seconds.
      </p>
    </div>
    <div class="steps">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h3>Upload Your Photos</h3>
          <p>Upload a front-facing photo and optional side profile for face analysis, or full-body front and side photos for body analysis.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h3>AI Analysis</h3>
          <p>Our advanced AI analyzes your features, proportions, and posture in seconds, comparing against aesthetic guidelines.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h3>Get Results</h3>
          <p>Receive detailed ratings, personalized insights, and an action plan with realistic improvement suggestions.</p>
        </div>
      </div>
    </div>
    <div class="section-cta">
      <a href="#" data-page="analyze" data-scan-type="face" class="btn btn-primary">Start Face Analysis â†’</a>
      <a href="#" data-page="analyze" data-scan-type="body" class="btn btn-body" style="margin-left: 1rem;">Start Body Analysis â†’</a>
    </div>
  </section>
  </div>

  <!-- ANALYZE PAGE -->
  <div class="page-section" id="page-analyze">
  <!-- Upload Section -->
  <section class="upload-section" id="upload">
    <div class="upload-container">
      <div class="upload-header">
        <h2 id="upload-title">ðŸ“· Upload Your Photos</h2>
        <p id="upload-subtitle">Get your personalized analysis in seconds</p>
      </div>

      <!-- Scan Type Toggle -->
      <div class="scan-type-toggle">
        <button class="scan-type-btn face active" data-scan-type="face">ðŸ˜Š Face Scan</button>
        <button class="scan-type-btn body" data-scan-type="body">ðŸ‹ï¸ Body Scan</button>
      </div>

      <!-- Body Photo Tips (only show for body) -->
      <div class="body-photo-tips hidden" id="body-photo-tips">
        <h4>ðŸ“¸ Tips for best body photos</h4>
        <ul>
          <li>Step back - include head to feet</li>
          <li>Neutral stance, arms at sides</li>
          <li>Form-fitting clothing works best</li>
          <li>Good, consistent lighting</li>
          <li>Side photo shows posture better</li>
          <li>No baggy clothes or heavy layers</li>
        </ul>
      </div>

      <div class="upload-grid">
        <div class="upload-box" id="front-upload">
          <input type="file" id="front-input" accept="image/*">
          <div class="upload-content" id="front-content">
            <div class="upload-box-icon">ðŸ“¸</div>
            <h3 id="front-title">Front Photo</h3>
            <p class="required">* Required</p>
            <p id="front-desc">Face the camera directly with neutral expression</p>
          </div>
        </div>

        <div class="upload-box" id="side-upload">
          <input type="file" id="side-input" accept="image/*">
          <div class="upload-content" id="side-content">
            <div class="upload-box-icon">ðŸ“·</div>
            <h3 id="side-title">Side Profile</h3>
            <p class="optional">Recommended</p>
            <p id="side-desc">For more accurate jawline and chin analysis</p>
          </div>
        </div>
      </div>

      <!-- Optional inputs for body scan -->
      <div class="optional-inputs hidden" id="body-optional-inputs">
        <div class="optional-input">
          <label>Height (optional)</label>
          <input type="text" id="height-input" placeholder="e.g., 5'10&quot; or 178cm">
        </div>
        <div class="optional-input">
          <label>Weight (optional)</label>
          <input type="text" id="weight-input" placeholder="e.g., 170lbs or 77kg">
        </div>
        <div class="optional-input">
          <label>Gym Access</label>
          <select id="gym-input">
            <option value="">Select...</option>
            <option value="yes">Yes - Full gym</option>
            <option value="limited">Limited equipment</option>
            <option value="no">No gym access</option>
          </select>
        </div>
        <div class="optional-input">
          <label>Goal</label>
          <select id="goal-input">
            <option value="">Select...</option>
            <option value="lean">Get lean</option>
            <option value="bulk">Build muscle</option>
            <option value="recomp">Recomposition</option>
            <option value="maintain">Maintain</option>
          </select>
        </div>
      </div>

      <!-- Gender selector removed - now auto-inferred -->
      <!-- Hidden advanced override (collapsed by default) -->
      <details class="advanced-options" id="advanced-options">
        <summary>âš™ï¸ Advanced Options</summary>
        <div class="advanced-content">
          <label class="option-label">
            <span>Manual appearance override (optional):</span>
            <select id="manual-appearance-override">
              <option value="">Auto-detect (recommended)</option>
              <option value="male">Use masculine-presenting weights</option>
              <option value="female">Use feminine-presenting weights</option>
            </select>
          </label>
        </div>
      </details>

      <button class="analyze-btn" id="analyze-btn" disabled>
        âœ¨ Analyze My Face
      </button>

      <p style="text-align: center; color: var(--text-muted); font-size: 0.875rem; margin-top: 1rem;">
        Your photos are processed securely and never stored permanently.
      </p>
    </div>
  </section>

  <!-- Results Section -->
  <section class="results-section" id="results">
    <div class="results-container">
      <div class="results-header" id="results-header">
        <h2>âœ¨ Your Analysis Results</h2>
      </div>

      <!-- Results Tabs -->
      <div class="results-tabs">
        <button class="results-tab active" data-tab="overview">ðŸ“Š Overview</button>
        <button class="results-tab" data-tab="plan">ðŸ“‹ 14-Day Plan</button>
        <button class="results-tab" data-tab="style">ðŸ’‡ Style Guide</button>
        <button class="results-tab" data-tab="progress">ðŸ“ˆ Progress</button>
      </div>

      <!-- TAB: Overview -->
      <div class="results-tab-content active" id="tab-overview">

      <!-- Retake Guidance (shown if photo quality is poor) -->
      <div class="retake-guidance hidden" id="retake-guidance">
        <h4>ðŸ“¸ Better photos = better results</h4>
        <div class="retake-tips">
          <div class="retake-tip">
            <span class="retake-tip-icon">ðŸ’¡</span>
            <span>Face natural light (window)</span>
          </div>
          <div class="retake-tip">
            <span class="retake-tip-icon">ðŸ“</span>
            <span>Camera at eye level</span>
          </div>
          <div class="retake-tip">
            <span class="retake-tip-icon">ðŸ˜</span>
            <span>Neutral expression</span>
          </div>
          <div class="retake-tip">
            <span class="retake-tip-icon">ðŸŽ¯</span>
            <span>Center your face</span>
          </div>
        </div>
        <button class="retake-btn" onclick="handleRetake()">ðŸ“· Retake for better accuracy</button>
      </div>

      <!-- Photo Quality Warnings -->
      <div class="photo-quality-box" id="photo-quality-box" style="display: none;">
        <div class="photo-quality-header">
          <span id="photo-quality-icon">âš ï¸</span>
          <span class="photo-quality-title" id="photo-quality-title">Photo Quality Issues</span>
        </div>
        <div class="photo-quality-issues" id="photo-quality-issues">
          <!-- Issues populated by JS -->
        </div>
      </div>

      <!-- Appearance Profile Card (auto-inferred) -->
      <div class="appearance-profile-card" id="appearance-profile-card">
        <div class="appearance-profile-header">
          <h4>ðŸ” Appearance Profile</h4>
          <label class="hide-appearance-toggle">
            <input type="checkbox" id="hide-appearance-toggle">
            <span>Hide</span>
          </label>
        </div>
        
        <div id="appearance-profile-content">
          <div class="appearance-grid">
            <div class="appearance-item">
              <div class="appearance-item-label">Presentation</div>
              <div class="appearance-item-value">
                <span id="presentation-value">â€”</span>
                <span class="confidence-pill medium" id="presentation-confidence">â€”</span>
              </div>
            </div>
            <div class="appearance-item">
              <div class="appearance-item-label">Age Estimate</div>
              <div class="appearance-item-value">
                <span id="age-range-value">â€”</span>
              </div>
            </div>
          </div>

          <div class="appearance-item" style="margin-top: 1rem;">
            <div class="appearance-item-label">Dimorphism Score</div>
            <div class="appearance-item-value">
              <span id="dimorphism-value">â€”</span>/10
            </div>
            <div class="dimorphism-bar">
              <div class="dimorphism-bar-container">
                <div class="dimorphism-marker" id="dimorphism-marker" style="left: 50%;"></div>
              </div>
            </div>
            <div class="dimorphism-labels">
              <span>Neutral</span>
              <span>Pronounced</span>
            </div>
          </div>

          <div class="appearance-item" style="margin-top: 1rem;">
            <div class="appearance-item-label">Masculinity / Femininity</div>
            <div class="masc-fem-bars">
              <div class="mf-bar">
                <span class="mf-bar-label">Masculine</span>
                <div class="mf-bar-track">
                  <div class="mf-bar-fill masc" id="masc-bar" style="width: 0%;"></div>
                </div>
                <span class="mf-bar-value" id="masc-value">â€”</span>
              </div>
              <div class="mf-bar">
                <span class="mf-bar-label">Feminine</span>
                <div class="mf-bar-track">
                  <div class="mf-bar-fill fem" id="fem-bar" style="width: 0%;"></div>
                </div>
                <span class="mf-bar-value" id="fem-value">â€”</span>
              </div>
            </div>
          </div>

          <div class="low-confidence-warning hidden" id="appearance-low-confidence">
            âš ï¸ <span>Uncertain â€” estimates may vary with different photos</span>
          </div>

          <div class="appearance-disclaimer">
            <span>â„¹ï¸</span>
            <span>Estimates based on this photo. Lighting, angle, and expression can affect results. These are visual observations, not identity statements.</span>
          </div>
        </div>
      </div>

      <!-- Harmony Index Card (Golden Ratio / Phi-based) -->
      <div class="harmony-index-card" id="harmony-index-card" style="display: none;">
        <div class="harmony-index-header">
          <h4>ðŸ“ Harmony Index</h4>
          <span class="harmony-score-badge" id="harmony-score-badge">â€”/10</span>
        </div>
        <div class="harmony-components" id="harmony-components">
          <!-- Populated by JS -->
        </div>
      </div>

      <div class="overall-score" id="overall-score-section">
        <!-- Dual Score Display -->
        <div class="dual-score-container">
          <div class="score-circle" id="current-score-circle">
            <span class="score-label">CURRENT</span>
            <span class="score-value" id="current-score">5.4</span>
            <span class="score-max">/10</span>
            <span class="score-context" id="current-context">Average</span>
            <div class="score-particles">
              <div class="particle" style="background: var(--score-color, var(--warning));"></div>
              <div class="particle" style="background: var(--score-color, var(--warning));"></div>
              <div class="particle" style="background: var(--score-color, var(--warning));"></div>
              <div class="particle" style="background: var(--score-color, var(--warning));"></div>
              <div class="particle" style="background: var(--score-color, var(--warning));"></div>
              <div class="particle" style="background: var(--score-color, var(--warning));"></div>
            </div>
          </div>
          
          <div class="potential-gain">
            <div class="gain-badge">
              <span id="gain-value">+1.4</span>
            </div>
            <span class="gain-label">possible</span>
          </div>

          <div class="score-circle potential" id="potential-score-circle">
            <span class="score-label">POTENTIAL</span>
            <span class="score-value" id="potential-score">6.8</span>
            <span class="score-max">/10</span>
            <span class="score-context" id="potential-context">Above avg</span>
            <div class="score-particles">
              <div class="particle" style="background: var(--success);"></div>
              <div class="particle" style="background: var(--success);"></div>
              <div class="particle" style="background: var(--success);"></div>
              <div class="particle" style="background: var(--success);"></div>
              <div class="particle" style="background: var(--success);"></div>
              <div class="particle" style="background: var(--success);"></div>
            </div>
          </div>
        </div>

        <!-- Confidence Badge -->
        <div class="confidence-badge medium" id="confidence-badge">
          <span class="confidence-dot"></span>
          <span id="confidence-text">Medium Confidence</span>
        </div>

        <p class="score-summary" id="score-summary">Loading...</p>

        <!-- Calibration Note -->
        <div class="calibration-note">
          <span>ðŸ“Š</span>
          <span id="calibration-note">Scores use realistic distribution where 5.5 is average. Most people score 4.5-6.5.</span>
        </div>

        <!-- Best Version CTA - Only for Face Analysis -->
        <div class="best-version-cta" id="best-version-cta" style="display: none;">
          <div class="best-version-inner">
            <div class="best-version-glow"></div>
            <div class="best-version-icon">âœ¨</div>
            <div class="best-version-content">
              <h4>See Your Best Version!</h4>
              <p>AI-enhanced photo with optimized lighting, skin & styling</p>
            </div>
            <span class="best-version-arrow">â†’</span>
          </div>
        </div>
      </div>

      <!-- Best Version Modal -->
      <div class="best-version-modal" id="best-version-modal">
        <div class="best-version-modal-backdrop"></div>
        <div class="best-version-modal-content">
          <button class="best-version-close" id="best-version-close">Ã—</button>
          
          <!-- Loading State -->
          <div class="best-version-loading" id="best-version-loading">
            <div class="best-version-loading-image" id="best-version-loading-image"></div>
            <div class="best-version-loading-spinner"></div>
            <h3>Creating Your Best Version</h3>
            <p class="best-version-loading-text" id="best-version-loading-text">Analyzing your features...</p>
            <div class="best-version-progress">
              <div class="best-version-progress-dot active"></div>
              <div class="best-version-progress-dot"></div>
              <div class="best-version-progress-dot"></div>
              <div class="best-version-progress-dot"></div>
              <div class="best-version-progress-dot"></div>
            </div>
          </div>

          <!-- Results State -->
          <div class="best-version-results" id="best-version-results" style="display: none;">
            <h3>âœ¨ Your Best Version</h3>
            
            <div class="best-version-toggle">
              <button class="best-version-toggle-btn active" data-view="after">After âœ¨</button>
              <button class="best-version-toggle-btn" data-view="before">Before</button>
            </div>
            
            <div class="best-version-image-container">
              <img id="best-version-image" src="" alt="Best Version" />
              <div class="best-version-badge" id="best-version-badge">Enhanced</div>
            </div>

            <div class="best-version-fallback-notice" id="best-version-fallback-notice" style="display: none;">
              <span>â„¹ï¸</span>
              <span>Demo Mode: Showing your enhancement plan (AI image generation coming soon)</span>
            </div>

            <div class="best-version-changes">
              <h4>ðŸŽ¯ Enhancements Applied</h4>
              <div class="best-version-changes-list" id="best-version-changes-list">
                <!-- Changes populated by JS -->
              </div>
            </div>

            <button class="best-version-retry" id="best-version-retry">Try Another Photo</button>
          </div>
        </div>
      </div>

      <!-- Delta Breakdown -->
      <div class="delta-breakdown" id="delta-breakdown">
        <h4>ðŸ“ˆ Your Improvement Potential Breakdown</h4>
        <div id="delta-items">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Top 3 Levers -->
      <div class="top-levers">
        <div class="top-levers-header">
          <h3>ðŸŽ¯ Your Top 3 Levers <span>Highest-impact improvements</span></h3>
          <div class="total-gain-badge">
            <span class="total-gain-value" id="total-gain">+1.4</span>
            <span class="total-gain-label">total</span>
          </div>
        </div>
        <div id="levers-container">
          <!-- Levers populated by JS -->
        </div>
        <div class="timeline-note">
          <span>â±ï¸ Full potential in <strong id="timeline-to-full">12-16 weeks</strong></span>
        </div>
      </div>

      <div class="features-results" id="features-results">
        <!-- Features will be populated by JS -->
      </div>

      <div class="top-fixes" id="top-fixes-section">
        <h3>ðŸ› ï¸ All Improvement Opportunities</h3>
        <div id="fixes-container">
          <!-- Fixes will be populated by JS -->
        </div>
      </div>

      </div><!-- End TAB: Overview -->

      <!-- TAB: 14-Day Plan -->
      <div class="results-tab-content" id="tab-plan">
        <div class="action-plan">
          <div class="action-plan-header">
            <h3>ðŸ“‹ Your 14-Day Glow Up Plan <span>Auto-generated from your scan</span></h3>
            <div class="streak-badge">
              <span class="fire">ðŸ”¥</span>
              <span class="streak-count" id="streak-count">0</span>
              <span class="streak-label">day streak</span>
            </div>
          </div>

          <div class="day-selector" id="day-selector">
            <!-- Days 1-14 populated by JS -->
          </div>

          <div class="daily-checklist">
            <div class="checklist-header">
              <h4 id="checklist-day-title">Day 1 Tasks</h4>
              <span class="checklist-progress" id="checklist-progress">0/6 completed</span>
            </div>
            <div id="checklist-items">
              <!-- Checklist items populated by JS -->
            </div>
          </div>
        </div>

        <div class="weekly-recap">
          <h4>ðŸ“Š Weekly Progress</h4>
          <div class="recap-stats">
            <div class="recap-stat">
              <div class="recap-stat-value" id="tasks-completed">0</div>
              <div class="recap-stat-label">Tasks Done</div>
            </div>
            <div class="recap-stat">
              <div class="recap-stat-value" id="streak-days">0</div>
              <div class="recap-stat-label">Day Streak</div>
            </div>
            <div class="recap-stat">
              <div class="recap-stat-value" id="consistency-pct">0%</div>
              <div class="recap-stat-label">Consistency</div>
            </div>
          </div>
        </div>
      </div><!-- End TAB: Plan -->

      <!-- TAB: Style Guide -->
      <div class="results-tab-content" id="tab-style">
        <div class="style-engine">
          <h3>ðŸ’‡ Your Personalized Style Guide</h3>

          <div class="style-tabs">
            <button class="style-tab active" data-style="haircut">ðŸ’‡ Haircuts</button>
            <button class="style-tab" data-style="brows">ðŸŽ¯ Brows</button>
            <button class="style-tab" data-style="facial-hair">ðŸ§” Facial Hair</button>
            <button class="style-tab" data-style="glasses">ðŸ‘“ Glasses</button>
            <button class="style-tab" data-style="skin">âœ¨ Skin Routine</button>
          </div>

          <!-- Haircuts -->
          <div class="style-content active" id="style-haircut">
            <div class="style-grid" id="haircut-recommendations">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Brows -->
          <div class="style-content" id="style-brows">
            <div class="style-grid" id="brow-recommendations">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Facial Hair -->
          <div class="style-content" id="style-facial-hair">
            <div class="style-grid" id="facial-hair-recommendations">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Glasses -->
          <div class="style-content" id="style-glasses">
            <div class="style-grid" id="glasses-recommendations">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Skin Routine -->
          <div class="style-content" id="style-skin">
            <div class="skin-routine" id="am-routine">
              <div class="routine-time">â˜€ï¸ Morning Routine</div>
              <ol class="routine-steps" id="am-routine-steps">
                <!-- Populated by JS -->
              </ol>
            </div>
            <div class="skin-routine" style="margin-top: 1rem;" id="pm-routine">
              <div class="routine-time">ðŸŒ™ Night Routine</div>
              <ol class="routine-steps" id="pm-routine-steps">
                <!-- Populated by JS -->
              </ol>
            </div>
          </div>
        </div>
      </div><!-- End TAB: Style -->

      <!-- TAB: Progress -->
      <div class="results-tab-content" id="tab-progress">
        <div class="progress-section">
          <div class="progress-header">
            <h3>ðŸ“ˆ Your Progress Journey</h3>
            <button class="save-progress-btn" id="save-progress-btn">ðŸ’¾ Save This Scan</button>
          </div>

          <div class="progress-gallery" id="progress-gallery">
            <!-- Populated by JS or show empty state -->
          </div>

          <div class="progress-empty hidden" id="progress-empty">
            <p>ðŸ“· No progress photos yet</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Save this scan to start tracking your glow up journey!</p>
          </div>

          <div class="compare-mode hidden" id="compare-mode">
            <h4>ðŸ”„ Before & After Comparison</h4>
            <div class="compare-slider-container" id="compare-container">
              <img src="" alt="Before" class="before-image" id="compare-before">
              <img src="" alt="After" class="after-image" id="compare-after">
              <div class="compare-slider" id="compare-slider"></div>
            </div>
            <div class="compare-labels">
              <span>Before</span>
              <span>After</span>
            </div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 1rem;">
          <p style="color: var(--text-muted); font-size: 0.9rem;">
            ðŸ’¡ Tip: Re-scan weekly to track your progress. Use the same lighting and angle for best comparison.
          </p>
        </div>
      </div><!-- End TAB: Progress -->

      <button class="new-scan-btn" id="new-scan-btn">
        ðŸ“· Start New Analysis
      </button>
    </div>
  </section>

  <!-- Loading Overlay -->
  <div class="loading-overlay hidden" id="loading">
    <div class="loading-spinner" id="loading-spinner"></div>
    <p class="loading-text" id="loading-text">Analyzing your features...</p>
    <p class="loading-subtext">This usually takes 10-20 seconds</p>
  </div>
  </div>

  <footer>
    <div class="footer-content">
      <div class="footer-logo">
        <span>âœ¨</span> LifeMAX
      </div>
      <p class="footer-text">
        AI-powered face and body aesthetics analysis. Results are estimates based on general guidelines.<br>
        Â© 2026 LifeMAX. Built for demonstration purposes.
      </p>
    </div>
  </footer>

  <script>
    // State
    let frontImage = null;
    let sideImage = null;
    let currentScanType = 'face'; // 'face' or 'body'
    let hideAppearanceEstimates = false; // Toggle state
    // For local testing use: 'http://localhost:3001'
    // For mobile/public testing, use the tunnel URL:
    const API_URL = 'http://localhost:3001';

    // Scroll to top on page load
    window.onload = function() {
      window.scrollTo(0, 0);
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    };

    // Page Navigation System
    function showPage(pageName, scanType = null) {
      // Hide all pages
      document.querySelectorAll('.page-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Show selected page
      const targetPage = document.getElementById('page-' + pageName);
      if (targetPage) {
        targetPage.classList.add('active');
        window.scrollTo(0, 0);
      }
      
      // Update nav links
      document.querySelectorAll('.nav-links a').forEach(link => {
        link.classList.remove('active');
        if (link.dataset.page === pageName) {
          link.classList.add('active');
        }
      });

      // If going to analyze page with scan type, set it
      if (pageName === 'analyze' && scanType) {
        setScanType(scanType);
      }
    }

    // Set scan type (face or body)
    function setScanType(type) {
      currentScanType = type;
      
      // Update toggle buttons
      document.querySelectorAll('.scan-type-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.scanType === type) {
          btn.classList.add('active');
        }
      });

      // Update UI based on scan type
      const uploadTitle = document.getElementById('upload-title');
      const uploadSubtitle = document.getElementById('upload-subtitle');
      const frontTitle = document.getElementById('front-title');
      const frontDesc = document.getElementById('front-desc');
      const sideTitle = document.getElementById('side-title');
      const sideDesc = document.getElementById('side-desc');
      const analyzeBtn = document.getElementById('analyze-btn');
      const bodyTips = document.getElementById('body-photo-tips');
      const bodyInputs = document.getElementById('body-optional-inputs');
      const frontUpload = document.getElementById('front-upload');
      const sideUpload = document.getElementById('side-upload');

      if (type === 'body') {
        uploadTitle.textContent = 'ðŸ‹ï¸ Upload Your Body Photos';
        uploadSubtitle.textContent = 'Get your personalized physique analysis';
        frontTitle.textContent = 'Front Body Photo';
        frontDesc.textContent = 'Stand straight, arms relaxed, head to feet visible';
        sideTitle.textContent = 'Side Body Photo';
        sideDesc.textContent = 'For posture and profile assessment';
        analyzeBtn.textContent = 'ðŸ‹ï¸ Analyze My Body';
        analyzeBtn.classList.add('body-mode');
        bodyTips.classList.remove('hidden');
        bodyInputs.classList.remove('hidden');
        frontUpload.classList.add('body-mode');
        sideUpload.classList.add('body-mode');
      } else {
        uploadTitle.textContent = 'ðŸ“· Upload Your Photos';
        uploadSubtitle.textContent = 'Get your personalized facial analysis';
        frontTitle.textContent = 'Front Photo';
        frontDesc.textContent = 'Face the camera directly with neutral expression';
        sideTitle.textContent = 'Side Profile';
        sideDesc.textContent = 'For more accurate jawline and chin analysis';
        analyzeBtn.textContent = 'âœ¨ Analyze My Face';
        analyzeBtn.classList.remove('body-mode');
        bodyTips.classList.add('hidden');
        bodyInputs.classList.add('hidden');
        frontUpload.classList.remove('body-mode');
        sideUpload.classList.remove('body-mode');
      }
    }

    // Add click handlers to navigation
    document.addEventListener('DOMContentLoaded', function() {
      // All elements with data-page attribute
      document.querySelectorAll('[data-page]').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const scanType = this.dataset.scanType || null;
          showPage(this.dataset.page, scanType);
        });
      });

      // Logo click goes to home
      document.querySelector('.logo').addEventListener('click', function(e) {
        e.preventDefault();
        showPage('home');
      });

      // Scan type toggle buttons
      document.querySelectorAll('.scan-type-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          setScanType(this.dataset.scanType);
      });
    });

      // Scan cards on home page
      document.querySelectorAll('.scan-card').forEach(card => {
        card.addEventListener('click', function() {
          const scanType = this.dataset.scanType;
          showPage('analyze', scanType);
        });
      });
    });

    // DOM Elements
    const frontUpload = document.getElementById('front-upload');
    const sideUpload = document.getElementById('side-upload');
    const frontInput = document.getElementById('front-input');
    const sideInput = document.getElementById('side-input');
    const frontContent = document.getElementById('front-content');
    const sideContent = document.getElementById('side-content');
    const analyzeBtn = document.getElementById('analyze-btn');
    const loadingOverlay = document.getElementById('loading');
    const resultsSection = document.getElementById('results');
    const uploadSection = document.getElementById('upload');
    const newScanBtn = document.getElementById('new-scan-btn');
    const manualOverrideSelect = document.getElementById('manual-appearance-override');
    const hideAppearanceToggle = document.getElementById('hide-appearance-toggle');

    // Convert file to base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
          const base64 = reader.result.split(',')[1];
          resolve(base64);
        };
        reader.onerror = error => reject(error);
      });
    }

    // Update upload box with preview
    function updateUploadBox(type, file, base64) {
      const content = type === 'front' ? frontContent : sideContent;
      const box = type === 'front' ? frontUpload : sideUpload;
      
      if (file) {
        const url = URL.createObjectURL(file);
        content.innerHTML = `
          <img src="${url}" class="upload-preview" alt="${type} photo">
          <button class="upload-remove" onclick="removeImage('${type}', event)">Remove</button>
        `;
        box.classList.add('has-image');
      } else {
        const isRequired = type === 'front';
        const isBody = currentScanType === 'body';
        content.innerHTML = `
          <div class="upload-box-icon">${type === 'front' ? 'ðŸ“¸' : 'ðŸ“·'}</div>
          <h3>${isBody ? (type === 'front' ? 'Front Body Photo' : 'Side Body Photo') : (type === 'front' ? 'Front Photo' : 'Side Profile')}</h3>
          <p class="${isRequired ? 'required' : 'optional'}">${isRequired ? '* Required' : 'Recommended'}</p>
          <p>${isBody 
            ? (type === 'front' ? 'Stand straight, arms relaxed, head to feet visible' : 'For posture and profile assessment')
            : (type === 'front' ? 'Face the camera directly with neutral expression' : 'For more accurate jawline and chin analysis')}</p>
        `;
        box.classList.remove('has-image');
      }

      updateAnalyzeButton();
    }

    // Remove image
    window.removeImage = function(type, event) {
      event.stopPropagation();
      if (type === 'front') {
        frontImage = null;
        frontInput.value = '';
        updateUploadBox('front', null);
      } else {
        sideImage = null;
        sideInput.value = '';
        updateUploadBox('side', null);
      }
    };

    // Update analyze button state
    function updateAnalyzeButton() {
      analyzeBtn.disabled = !frontImage;
    }

    // Handle file selection
    frontUpload.addEventListener('click', () => frontInput.click());
    sideUpload.addEventListener('click', () => sideInput.click());

    frontInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        frontImage = await fileToBase64(file);
        updateUploadBox('front', file, frontImage);
      }
    });

    sideInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        sideImage = await fileToBase64(file);
        updateUploadBox('side', file, sideImage);
      }
    });

    // Gender selection
    genderBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        genderBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedGender = btn.dataset.gender;
      });
    });

    // Analyze
    analyzeBtn.addEventListener('click', async () => {
      if (!frontImage) return;

      const loadingSpinner = document.getElementById('loading-spinner');
      const loadingText = document.getElementById('loading-text');

      loadingOverlay.classList.remove('hidden');
      
      if (currentScanType === 'body') {
        loadingSpinner.classList.add('body-mode');
        loadingText.textContent = 'Analyzing your physique...';
      } else {
        loadingSpinner.classList.remove('body-mode');
        loadingText.textContent = 'Analyzing your features...';
      }

      try {
        // First check if server is reachable
        const healthCheck = await fetch(`${API_URL}/health`, { 
          method: 'GET',
          signal: AbortSignal.timeout(5000)
        }).catch(() => null);

        if (!healthCheck || !healthCheck.ok) {
          throw new Error('SERVER_OFFLINE');
        }

        loadingText.textContent = currentScanType === 'body' 
          ? 'AI is analyzing your physique...' 
          : 'AI is analyzing your face...';

        const endpoint = currentScanType === 'body' ? '/api/body/analyze' : '/api/face/analyze';
        
        const requestBody = {
            frontImage,
            sideImage,
            gender: manualOverrideSelect?.value || null, // Optional manual override, or auto-detect
            premiumEnabled: false,
        };

        // Add body-specific inputs
        if (currentScanType === 'body') {
          requestBody.height = document.getElementById('height-input').value;
          requestBody.weight = document.getElementById('weight-input').value;
          requestBody.gymAccess = document.getElementById('gym-input').value;
          requestBody.goal = document.getElementById('goal-input').value;
        }

        const response = await fetch(`${API_URL}${endpoint}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestBody),
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          const errorMsg = errorData.message || errorData.error || 'Analysis failed';
          const error = new Error(errorMsg);
          error.suggestion = errorData.suggestion;
          throw error;
        }

        const data = await response.json();
        displayResults(data, false);
      } catch (error) {
        console.error('Error:', error);
        loadingOverlay.classList.add('hidden');
        
        if (error.message === 'SERVER_OFFLINE' || error.message.includes('API key not configured') || error.message.includes('GEMINI_API_KEY')) {
          // Show demo results when server is offline (for portfolio/showcase)
          console.log('Server offline - showing demo results');
          const demoData = currentScanType === 'body' ? getMockBodyResults() : getMockResults();
          displayResults(demoData, true);
          return;
        } else if (error.message.includes('No face detected') || error.message.includes("doesn't appear to be")) {
          alert('ðŸ™ˆ Image Issue\n\n' + error.message + '\n\nPlease upload a clear photo.');
        } else {
          // For any other error, also show demo results
          console.log('Error occurred - showing demo results:', error.message);
          const demoData = currentScanType === 'body' ? getMockBodyResults() : getMockResults();
          displayResults(demoData, true);
        return;
        }
      } finally {
        loadingOverlay.classList.add('hidden');
      }
    });

    // Get score color based on value
    function getScoreColor(score) {
      if (score <= 4) return '#EF4444'; // red
      if (score <= 5.5) return '#F59E0B'; // warning/yellow
      if (score <= 7) return '#10B981'; // green
      return '#8B5CF6'; // purple/excellent
    }

    // Get score context text
    function getScoreContext(score) {
      if (score <= 3) return 'Below average';
      if (score <= 4.5) return 'Slightly below avg';
      if (score <= 5.5) return 'Average';
      if (score <= 6.5) return 'Slightly above avg';
      if (score <= 7.5) return 'Above average';
      if (score <= 8.5) return 'Well above avg';
      return 'Exceptional';
    }

    // Display results
    function displayResults(data, isDemo = false) {
      uploadSection.classList.add('hidden');
      resultsSection.classList.add('visible');

      const isBody = currentScanType === 'body';
      const resultsHeader = document.getElementById('results-header');
      const overallSection = document.getElementById('overall-score-section');
      const topFixesSection = document.getElementById('top-fixes-section');

      // Update header based on scan type
      if (isDemo) {
        resultsHeader.innerHTML = `<h2>âš ï¸ Demo Results (Server Offline)</h2>`;
      } else {
        resultsHeader.innerHTML = isBody 
          ? `<h2>ðŸ‹ï¸ Your Body Analysis Results</h2>` 
          : `<h2>âœ¨ Your Face Analysis Results</h2>`;
      }

      // Add body mode classes
      if (isBody) {
        resultsHeader.classList.add('body-mode');
        overallSection.classList.add('body-mode');
        topFixesSection.classList.add('body-mode');
      } else {
        resultsHeader.classList.remove('body-mode');
        overallSection.classList.remove('body-mode');
        topFixesSection.classList.remove('body-mode');
      }

      // Photo quality warnings
      const photoQualityBox = document.getElementById('photo-quality-box');
      if (data.photoQuality && data.photoQuality.issues && data.photoQuality.issues.length > 0) {
        photoQualityBox.style.display = 'block';
        const issueMessages = {
          side_missing: 'Side photo missing',
          too_dark: 'Lighting too dark',
          too_bright: 'Overexposed',
          angle_distortion: 'Angle distortion',
          blurry: 'Image blurry',
          inconsistent_lighting: 'Uneven lighting',
          not_full_body: 'Not full body visible',
          baggy_clothes: 'Clothing too loose',
          pose_inconsistent: 'Inconsistent pose'
        };
        document.getElementById('photo-quality-issues').innerHTML = 
          data.photoQuality.issues.map(issue => 
            `<span class="photo-issue-tag">${issueMessages[issue] || issue}</span>`
          ).join('');
      } else {
        photoQualityBox.style.display = 'none';
      }

      // Current vs Potential scores
      const currentScore = data.overall.currentScore10;
      const potentialScore = data.overall.potentialScore10;
      const gain = potentialScore - currentScore;
      const currentColor = getScoreColor(currentScore);
      const potentialColor = getScoreColor(potentialScore);

      // Set colors immediately
      const currentCircle = document.getElementById('current-score-circle');
      const potentialCircle = document.getElementById('potential-score-circle');
      
      currentCircle.style.setProperty('--score-color', currentColor);
      potentialCircle.style.setProperty('--score-color', potentialColor);

      // Reset animations
      currentCircle.style.animation = 'none';
      potentialCircle.style.animation = 'none';
      currentCircle.offsetHeight;
      potentialCircle.offsetHeight;
      currentCircle.style.animation = '';
      potentialCircle.style.animation = '';

      // Start with 0 and animate up
      currentCircle.style.setProperty('--score-progress', 0);
      potentialCircle.style.setProperty('--score-progress', 0);
      document.getElementById('current-score').textContent = '0.0';
      document.getElementById('potential-score').textContent = '0.0';
      document.getElementById('gain-value').textContent = '+0.0';

      // Animate the ring filling and score counting
      const animationDuration = 2000;
      const startTime = Date.now();
      const ringDelay = 1500;

      setTimeout(() => {
        function animateScores() {
          const elapsed = Date.now() - startTime - ringDelay;
          const progress = Math.min(elapsed / animationDuration, 1);
          const easedProgress = 1 - Math.pow(1 - progress, 3);

          const displayedCurrentScore = currentScore * easedProgress;
          document.getElementById('current-score').textContent = displayedCurrentScore.toFixed(1);
          currentCircle.style.setProperty('--score-progress', displayedCurrentScore);

          const potentialProgress = Math.max(0, (progress - 0.1) / 0.9);
          const easedPotentialProgress = potentialProgress > 0 ? 1 - Math.pow(1 - potentialProgress, 3) : 0;
          const displayedPotentialScore = potentialScore * easedPotentialProgress;
          document.getElementById('potential-score').textContent = displayedPotentialScore.toFixed(1);
          potentialCircle.style.setProperty('--score-progress', displayedPotentialScore);

          const displayedGain = (displayedPotentialScore - displayedCurrentScore);
          if (displayedGain > 0) {
            document.getElementById('gain-value').textContent = `+${displayedGain.toFixed(1)}`;
          }

          if (progress < 1) {
            requestAnimationFrame(animateScores);
          } else {
            document.getElementById('current-score').textContent = currentScore.toFixed(1);
            document.getElementById('potential-score').textContent = potentialScore.toFixed(1);
            document.getElementById('gain-value').textContent = `+${gain.toFixed(1)}`;
            currentCircle.style.setProperty('--score-progress', currentScore);
            potentialCircle.style.setProperty('--score-progress', potentialScore);
          }
        }
        animateScores();
      }, ringDelay);

      document.getElementById('current-context').textContent = getScoreContext(currentScore);
      document.getElementById('potential-context').textContent = getScoreContext(potentialScore);
      document.getElementById('score-summary').textContent = data.overall.summary;

      if (data.overall.calibrationNote) {
        document.getElementById('calibration-note').textContent = data.overall.calibrationNote;
      }

      // Confidence badge
      const confidence = data.overall.confidence || 'medium';
      const confidenceBadge = document.getElementById('confidence-badge');
      confidenceBadge.className = `confidence-badge ${confidence}`;
      const confidenceLabels = { low: 'Low Confidence', medium: 'Medium Confidence', high: 'High Confidence' };
      document.getElementById('confidence-text').textContent = confidenceLabels[confidence];

      // Show Best Version CTA for face analysis only
      const bestVersionCta = document.getElementById('best-version-cta');
      if (bestVersionCta) {
        if (isBody) {
          bestVersionCta.style.display = 'none';
        } else {
          bestVersionCta.style.display = 'block';
        }
      }

      // Top 3 Levers
      const leversContainer = document.getElementById('levers-container');
      const top3Levers = data.potential?.top3Levers || data.topLevers || [];
      const totalGain = data.potential?.totalPossibleGain || gain;
      
      document.getElementById('total-gain').textContent = `+${totalGain.toFixed(1)}`;
      document.getElementById('timeline-to-full').textContent = data.potential?.timelineToFullPotential || '12-16 weeks';

      leversContainer.innerHTML = top3Levers.map((lever, idx) => {
        const priorityClass = ['p1', 'p2', 'p3'][idx];
        const barColor = ['var(--success)', 'var(--warning)', 'var(--primary)'][idx];
        const barWidth = totalGain > 0 ? ((lever.delta || 0.3) / totalGain) * 100 : 33;
        const leverTitle = lever.lever || lever.title || 'Improvement';
        return `
          <div class="lever-item">
            <div class="lever-priority ${priorityClass}">#${idx + 1}</div>
            <div class="lever-content">
              <div class="lever-name">${leverTitle}</div>
              <div class="lever-meta">
                <span class="lever-delta">+${(lever.delta || 0.3).toFixed(1)}</span>
                <span class="lever-timeline">${lever.timeline || '4-8 weeks'}</span>
              </div>
            </div>
            <div class="lever-bar" style="width: ${barWidth}%; background: ${barColor};"></div>
          </div>
        `;
      }).join('');

      // Features - Expandable Cards
      const featuresContainer = document.getElementById('features-results');
      const features = data.features || [];
      featuresContainer.innerHTML = features.map((feature, idx) => {
        const featureColor = getScoreColor(feature.rating10);
        const holdingBack = feature.holdingBack || feature.limitations || feature.whatLimitsIt || feature.imperfections || [];
        const strengths = feature.strengths || [];
        const fixes = feature.fixes || feature.actions || [];
        const evidence = feature.evidence || feature.why || '';
        const featureKey = feature.key || feature.label || 'feature';
        
        // Generate detailed explanation based on the feature
        const detailedExplanation = generateFeatureExplanation(feature, isBody);
        
        return `
          <div class="feature-result-card ${isBody ? 'body-mode' : ''}" data-feature-key="${featureKey}" onclick="toggleFeatureCard(this)">
            <div class="feature-collapsed">
            <div class="feature-result-header">
                <span class="feature-result-name">
                  ${getFeatureIcon(featureKey)} ${feature.label || feature.key}
                  ${feature.confidence ? `<span class="feature-confidence-badge ${feature.confidence}">${feature.confidence}</span>` : ''}
                </span>
              <span class="feature-result-score" style="color: ${featureColor}">${feature.rating10.toFixed(1)}/10</span>
              </div>
              <span class="feature-expand-icon">â–¼</span>
            </div>
            <div class="feature-result-bar">
              <div class="feature-result-fill" style="width: ${feature.rating10 * 10}%; background: linear-gradient(90deg, ${featureColor}, ${featureColor}99);"></div>
            </div>
            
            <div class="feature-expanded-content">
              <!-- Why This Score -->
              <div class="feature-section">
                <div class="feature-section-title">ðŸ“Š Why This Score</div>
                <div class="feature-evidence">${detailedExplanation}</div>
              </div>
              
              ${strengths.length > 0 ? `
              <!-- Strengths -->
              <div class="feature-section">
                <div class="feature-section-title">âœ… What's Working</div>
                <ul class="feature-strengths-list">
                  ${strengths.map(s => `<li><span>âœ“</span> ${s}</li>`).join('')}
            </ul>
              </div>
              ` : ''}
              
              ${holdingBack.length > 0 ? `
              <!-- What Limits It -->
              <div class="feature-section">
                <div class="feature-section-title">âš ï¸ What's Limiting This</div>
                <ul class="feature-limits-list">
                  ${holdingBack.map(l => `<li><span>â†’</span> ${l}</li>`).join('')}
                </ul>
              </div>
              ` : ''}
              
              ${fixes.length > 0 ? `
              <!-- How to Improve -->
              <div class="feature-section">
                <div class="feature-section-title">ðŸŽ¯ How to Improve</div>
                <div class="feature-fixes">
                  ${fixes.slice(0, 3).map(fix => `
                    <div class="feature-fix-item">
                      <div class="feature-fix-header">
                        <span class="feature-fix-title">${fix.title || fix.name || fix}</span>
                        ${fix.delta ? `<span class="feature-fix-delta">+${fix.delta.toFixed(1)}</span>` : ''}
                      </div>
                      <div class="feature-fix-meta">
                        <span>â±ï¸ ${fix.timeline || fix.time || '2-4 weeks'}</span>
                        <span>ðŸ“ˆ ${fix.difficulty || 'Easy'}</span>
                        ${fix.type ? `<span>ðŸ’° ${fix.type.replace('_', ' ')}</span>` : ''}
                      </div>
                      ${fix.steps && fix.steps.length > 0 ? `
                      <ul class="feature-fix-steps">
                        ${fix.steps.slice(0, 4).map(step => `<li>${step}</li>`).join('')}
                      </ul>
                      ` : ''}
                    </div>
                  `).join('')}
                </div>
              </div>
              ` : ''}
              
              <!-- Get Product Recommendations -->
              <button class="feature-recommend-btn" onclick="event.stopPropagation(); openRecommendModal('${featureKey}', '${feature.label || feature.key}', ${feature.rating10})">
                ðŸ›’ Get Product & Routine Recommendations
              </button>
            </div>
          </div>
        `;
      }).join('');

      // All improvement deltas
      const fixesContainer = document.getElementById('fixes-container');
      const deltas = data.potential?.deltas || data.topFixes || [];
      
      fixesContainer.innerHTML = deltas.slice(0, 6).map(delta => {
        const difficultyColors = { easy: 'var(--success)', moderate: 'var(--warning)', difficult: 'var(--error)' };
        return `
          <div class="fix-item">
            <div class="fix-header">
              <span class="fix-title">${delta.lever || delta.title}</span>
              <span class="fix-impact high">+${(delta.delta || 0.3).toFixed(1)}</span>
            </div>
            <p class="fix-why">${delta.currentIssue || delta.why || delta.potentialGain || ''}</p>
            <div style="display: flex; gap: 1rem; margin-bottom: 0.75rem; font-size: 0.85rem;">
              <span style="color: var(--text-muted);">â±ï¸ ${delta.timeline || '4-8 weeks'}</span>
              ${delta.difficulty ? `<span style="color: ${difficultyColors[delta.difficulty] || 'var(--text-muted)'};">${delta.difficulty}</span>` : ''}
            </div>
            <ul class="fix-steps">
              ${(delta.steps || []).slice(0, 3).map(step => `<li>${step}</li>`).join('')}
            </ul>
          </div>
        `;
      }).join('');

      // Display appearance profile if available
      displayAppearanceProfile(data.appearanceProfile);
      
      // Display harmony index if available
      displayHarmonyIndex(data.harmonyIndex);
      
      // Display potential range if available
      displayPotentialRange(data.potentialRange, data.overall);

      resultsSection.scrollIntoView({ behavior: 'smooth' });
    }

    // Display Appearance Profile
    function displayAppearanceProfile(profile) {
      const card = document.getElementById('appearance-profile-card');
      const content = document.getElementById('appearance-profile-content');
      
      if (!profile || !card) {
        if (card) card.style.display = 'none';
        return;
      }
      
      card.style.display = 'block';
      
      // Apply hide preference
      if (hideAppearanceEstimates) {
        content.style.display = 'none';
        return;
      }
      content.style.display = 'block';
      
      // Presentation
      const presentationEl = document.getElementById('presentation-value');
      const presentationConfEl = document.getElementById('presentation-confidence');
      
      const presentationLabels = {
        'male-presenting': 'Male-presenting',
        'female-presenting': 'Female-presenting',
        'ambiguous': 'Ambiguous'
      };
      
      if (presentationEl) {
        presentationEl.textContent = presentationLabels[profile.presentation] || profile.presentation;
      }
      
      if (presentationConfEl) {
        const confLevel = profile.confidence >= 0.75 ? 'high' : 
                          profile.confidence >= 0.5 ? 'medium' : 'low';
        presentationConfEl.textContent = `${Math.round(profile.confidence * 100)}%`;
        presentationConfEl.className = `confidence-pill ${confLevel}`;
      }
      
      // Age Range
      const ageRangeEl = document.getElementById('age-range-value');
      if (ageRangeEl) {
        if (profile.ageRange && profile.ageConfidence >= 0.65) {
          ageRangeEl.textContent = `${profile.ageRange.min}-${profile.ageRange.max} years`;
        } else if (profile.ageRange && profile.ageConfidence >= 0.4) {
          ageRangeEl.innerHTML = `~${profile.ageRange.min}-${profile.ageRange.max} <span style="font-size:0.7rem;color:var(--text-muted);">(uncertain)</span>`;
        } else {
          ageRangeEl.textContent = 'â€”';
        }
      }
      
      // Dimorphism Score
      const dimorphismEl = document.getElementById('dimorphism-value');
      const dimorphismMarker = document.getElementById('dimorphism-marker');
      if (dimorphismEl) {
        dimorphismEl.textContent = profile.dimorphismScore10?.toFixed(1) || 'â€”';
      }
      if (dimorphismMarker && profile.dimorphismScore10) {
        dimorphismMarker.style.left = `${profile.dimorphismScore10 * 10}%`;
      }
      
      // Masculinity / Femininity bars
      const mascBar = document.getElementById('masc-bar');
      const femBar = document.getElementById('fem-bar');
      const mascValue = document.getElementById('masc-value');
      const femValue = document.getElementById('fem-value');
      
      if (profile.masculinityFemininity) {
        const masc = profile.masculinityFemininity.masculinity || 50;
        const fem = profile.masculinityFemininity.femininity || 50;
        
        if (mascBar) mascBar.style.width = `${masc}%`;
        if (femBar) femBar.style.width = `${fem}%`;
        if (mascValue) mascValue.textContent = Math.round(masc);
        if (femValue) femValue.textContent = Math.round(fem);
      }
      
      // Low confidence warning
      const lowConfWarning = document.getElementById('appearance-low-confidence');
      if (lowConfWarning) {
        if (profile.confidence < 0.5) {
          lowConfWarning.classList.remove('hidden');
        } else {
          lowConfWarning.classList.add('hidden');
        }
      }
    }

    // Display Harmony Index (Golden Ratio / Phi-based)
    function displayHarmonyIndex(harmonyIndex) {
      const card = document.getElementById('harmony-index-card');
      const badge = document.getElementById('harmony-score-badge');
      const componentsEl = document.getElementById('harmony-components');
      
      if (!harmonyIndex || !card) {
        if (card) card.style.display = 'none';
        return;
      }
      
      card.style.display = 'block';
      
      if (badge) {
        badge.textContent = `${harmonyIndex.score10?.toFixed(1) || 'â€”'}/10`;
      }
      
      if (componentsEl && harmonyIndex.components) {
        const components = harmonyIndex.components;
        let html = '';
        
        if (components.facialSymmetry) {
          html += `
            <div class="harmony-component">
              <div class="harmony-component-name">âš–ï¸ Facial Symmetry</div>
              <div class="harmony-component-score">${components.facialSymmetry.score10?.toFixed(1) || 'â€”'}/10</div>
              ${components.facialSymmetry.note ? `<div class="harmony-component-note">${components.facialSymmetry.note}</div>` : ''}
            </div>
          `;
        }
        
        if (components.facialThirds) {
          const thirds = components.facialThirds;
          html += `
            <div class="harmony-component">
              <div class="harmony-component-name">ðŸ“ Facial Thirds</div>
              <div class="harmony-component-score">${thirds.score10?.toFixed(1) || 'â€”'}/10</div>
              ${thirds.idealDeviation ? `<div class="harmony-component-note">${thirds.idealDeviation}</div>` : 
                thirds.note ? `<div class="harmony-component-note">${thirds.note}</div>` : ''}
            </div>
          `;
        }
        
        if (components.horizontalFifths) {
          html += `
            <div class="harmony-component">
              <div class="harmony-component-name">â†”ï¸ Horizontal Fifths</div>
              <div class="harmony-component-score">${components.horizontalFifths.score10?.toFixed(1) || 'â€”'}/10</div>
              ${components.horizontalFifths.note ? `<div class="harmony-component-note">${components.horizontalFifths.note}</div>` : ''}
            </div>
          `;
        }
        
        if (components.goldenRatioProximity) {
          html += `
            <div class="harmony-component">
              <div class="harmony-component-name">âœ¨ Golden Ratio</div>
              <div class="harmony-component-score">${components.goldenRatioProximity.score10?.toFixed(1) || 'â€”'}/10</div>
              ${components.goldenRatioProximity.note ? `<div class="harmony-component-note">${components.goldenRatioProximity.note}</div>` : ''}
            </div>
          `;
        }
        
        componentsEl.innerHTML = html || '<div class="harmony-component"><div class="harmony-component-note">Detailed breakdown not available</div></div>';
      }
    }

    // Display Potential Range (min/max)
    function displayPotentialRange(potentialRange, overall) {
      // Add potential range below the potential score display
      const potentialCircle = document.getElementById('potential-score-circle');
      if (!potentialCircle || !potentialRange) return;
      
      // Check if range display already exists
      let rangeDisplay = potentialCircle.querySelector('.potential-range');
      if (!rangeDisplay) {
        rangeDisplay = document.createElement('div');
        rangeDisplay.className = 'potential-range';
        potentialCircle.appendChild(rangeDisplay);
      }
      
      rangeDisplay.innerHTML = `
        <span style="font-size: 0.75rem;">Range:</span>
        <span class="potential-range-values">${potentialRange.min?.toFixed(1)} - ${potentialRange.max?.toFixed(1)}</span>
      `;
    }

    // New scan
    newScanBtn.addEventListener('click', () => {
      frontImage = null;
      sideImage = null;
      frontInput.value = '';
      sideInput.value = '';
      updateUploadBox('front', null);
      updateUploadBox('side', null);
      resultsSection.classList.remove('visible');
      uploadSection.classList.remove('hidden');
      window.scrollTo(0, 0);
    });

    // ====== NEW FEATURES: TABS, PLAN, STYLE, PROGRESS ======

    // Global state for new features
    let currentAnalysisData = null;
    let currentDay = 1;
    let streak = parseInt(localStorage.getItem('glowup_streak') || '0');
    let completedTasks = JSON.parse(localStorage.getItem('glowup_tasks') || '{}');
    let progressHistory = JSON.parse(localStorage.getItem('glowup_progress') || '[]');

    // Results Tabs
    document.querySelectorAll('.results-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.results-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.results-tab-content').forEach(c => c.classList.remove('active'));
        
        this.classList.add('active');
        const tabId = this.dataset.tab;
        document.getElementById('tab-' + tabId).classList.add('active');
      });
    });

    // Style tabs
    document.querySelectorAll('.style-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.style-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.style-content').forEach(c => c.classList.remove('active'));
        
        this.classList.add('active');
        const styleId = this.dataset.style;
        document.getElementById('style-' + styleId).classList.add('active');
      });
    });

    // Handle retake
    window.handleRetake = function() {
      resultsSection.classList.remove('visible');
      uploadSection.classList.remove('hidden');
      window.scrollTo(0, 0);
    };

    // Display delta breakdown
    function displayDeltaBreakdown(data) {
      const container = document.getElementById('delta-items');
      const deltas = data.potential?.deltas || data.topLevers || [];
      
      // Create visual delta bars
      const maxDelta = Math.max(...deltas.map(d => d.delta || 0.3), 0.5);
      
      container.innerHTML = deltas.slice(0, 5).map(delta => {
        const width = ((delta.delta || 0.3) / maxDelta) * 100;
        return `
          <div class="delta-item">
            <span class="delta-label">${delta.lever || delta.title || 'Improvement'}</span>
            <div class="delta-bar-container">
              <div class="delta-bar" style="width: 0%;" data-width="${width}"></div>
            </div>
            <span class="delta-value">+${(delta.delta || 0.3).toFixed(1)}</span>
          </div>
        `;
      }).join('');

      // Animate bars
      setTimeout(() => {
        container.querySelectorAll('.delta-bar').forEach(bar => {
          bar.style.width = bar.dataset.width + '%';
        });
      }, 100);
    }

    // Generate 14-day plan based on analysis
    function generate14DayPlan(data) {
      const levers = data.potential?.top3Levers || data.topLevers || [];
      const features = data.features || [];
      
      const dailyTasks = [];
      
      // Generate tasks based on levers
      const taskTemplates = {
        skin: [
          { text: 'Complete AM skincare routine', category: 'Skincare' },
          { text: 'Complete PM skincare routine', category: 'Skincare' },
          { text: 'Apply SPF before going out', category: 'Skincare' },
          { text: 'Drink 8 glasses of water', category: 'Hydration' },
        ],
        hair: [
          { text: 'Style hair with product', category: 'Grooming' },
          { text: 'Research haircut styles for face shape', category: 'Grooming' },
        ],
        posture: [
          { text: '5 min posture exercises', category: 'Posture' },
          { text: 'Chin tucks - 3 sets of 10', category: 'Posture' },
          { text: 'Wall angels - 2 sets of 15', category: 'Posture' },
        ],
        fitness: [
          { text: 'Complete workout session', category: 'Fitness' },
          { text: 'Hit protein target (1g/lb)', category: 'Nutrition' },
          { text: '10,000 steps', category: 'Activity' },
        ],
        brows: [
          { text: 'Groom eyebrows', category: 'Grooming' },
        ],
        default: [
          { text: 'Check posture while sitting', category: 'Awareness' },
          { text: 'Take progress selfie', category: 'Progress' },
          { text: 'Practice positive self-talk', category: 'Mindset' },
          { text: 'Get 7-8 hours sleep', category: 'Recovery' },
        ]
      };

      // Build task pool based on analysis
      let taskPool = [...taskTemplates.default];
      
      levers.forEach(lever => {
        const leverName = (lever.lever || lever.title || '').toLowerCase();
        if (leverName.includes('skin')) taskPool.push(...taskTemplates.skin);
        if (leverName.includes('hair')) taskPool.push(...taskTemplates.hair);
        if (leverName.includes('posture')) taskPool.push(...taskTemplates.posture);
        if (leverName.includes('v-taper') || leverName.includes('muscle') || leverName.includes('lean')) {
          taskPool.push(...taskTemplates.fitness);
        }
        if (leverName.includes('brow')) taskPool.push(...taskTemplates.brows);
      });

      // Generate 14 days of tasks (6-8 per day)
      for (let day = 1; day <= 14; day++) {
        const dayTasks = [];
        const shuffled = [...taskPool].sort(() => Math.random() - 0.5);
        const tasksPerDay = Math.min(6 + Math.floor(Math.random() * 3), shuffled.length);
        
        for (let i = 0; i < tasksPerDay; i++) {
          dayTasks.push({
            id: `day${day}_task${i}`,
            ...shuffled[i % shuffled.length]
          });
        }
        dailyTasks.push(dayTasks);
      }

      return dailyTasks;
    }

    // Display 14-day plan
    function display14DayPlan(plan) {
      // Display day selector
      const daySelector = document.getElementById('day-selector');
      daySelector.innerHTML = Array.from({length: 14}, (_, i) => {
        const day = i + 1;
        const isCompleted = isDayCompleted(day);
        const isCurrent = day === currentDay;
        return `
          <button class="day-btn ${isCompleted ? 'completed' : ''} ${isCurrent ? 'current' : ''}" 
                  onclick="selectDay(${day})">${day}</button>
        `;
      }).join('');

      // Display current day's checklist
      displayDayChecklist(plan[currentDay - 1] || []);
      
      // Update streak
      updateStreak();
    }

    // Select a day
    window.selectDay = function(day) {
      currentDay = day;
      if (currentAnalysisData && currentAnalysisData.plan) {
        displayDayChecklist(currentAnalysisData.plan[day - 1] || []);
        
        // Update day buttons
        document.querySelectorAll('.day-btn').forEach((btn, i) => {
          btn.classList.remove('current');
          if (i + 1 === day) btn.classList.add('current');
        });
      }
    };

    // Display checklist for a day
    function displayDayChecklist(tasks) {
      const container = document.getElementById('checklist-items');
      const dayTitle = document.getElementById('checklist-day-title');
      dayTitle.textContent = `Day ${currentDay} Tasks`;

      const completed = tasks.filter(t => completedTasks[t.id]).length;
      document.getElementById('checklist-progress').textContent = `${completed}/${tasks.length} completed`;

      container.innerHTML = tasks.map(task => {
        const isComplete = completedTasks[task.id];
        return `
          <div class="checklist-item ${isComplete ? 'completed' : ''}" onclick="toggleTask('${task.id}')">
            <div class="checklist-checkbox">${isComplete ? 'âœ“' : ''}</div>
            <span class="checklist-text">${task.text}</span>
            <span class="checklist-category">${task.category}</span>
          </div>
        `;
      }).join('');
    }

    // Toggle task completion
    window.toggleTask = function(taskId) {
      completedTasks[taskId] = !completedTasks[taskId];
      localStorage.setItem('glowup_tasks', JSON.stringify(completedTasks));
      
      if (currentAnalysisData && currentAnalysisData.plan) {
        displayDayChecklist(currentAnalysisData.plan[currentDay - 1] || []);
        updateDayButtons();
        updateStreak();
        updateWeeklyRecap();
      }
    };

    // Check if day is completed (all tasks done)
    function isDayCompleted(day) {
      if (!currentAnalysisData || !currentAnalysisData.plan) return false;
      const tasks = currentAnalysisData.plan[day - 1] || [];
      return tasks.length > 0 && tasks.every(t => completedTasks[t.id]);
    }

    // Update day buttons
    function updateDayButtons() {
      document.querySelectorAll('.day-btn').forEach((btn, i) => {
        const day = i + 1;
        if (isDayCompleted(day)) {
          btn.classList.add('completed');
        } else {
          btn.classList.remove('completed');
        }
      });
    }

    // Update streak
    function updateStreak() {
      // Calculate streak
      let newStreak = 0;
      const today = new Date().toDateString();
      const lastActive = localStorage.getItem('glowup_last_active');
      
      if (lastActive === today) {
        newStreak = streak;
      } else {
        // Check if any tasks completed today
        const todayHasCompletions = Object.keys(completedTasks).some(id => completedTasks[id]);
        if (todayHasCompletions) {
          newStreak = streak + 1;
          localStorage.setItem('glowup_last_active', today);
        }
      }
      
      streak = newStreak;
      localStorage.setItem('glowup_streak', streak.toString());
      
      document.getElementById('streak-count').textContent = streak;
      document.getElementById('streak-days').textContent = streak;
    }

    // Update weekly recap
    function updateWeeklyRecap() {
      const totalTasks = Object.keys(completedTasks).length;
      const doneTasks = Object.values(completedTasks).filter(Boolean).length;
      const consistency = totalTasks > 0 ? Math.round((doneTasks / totalTasks) * 100) : 0;
      
      document.getElementById('tasks-completed').textContent = doneTasks;
      document.getElementById('consistency-pct').textContent = consistency + '%';
    }

    // Generate style recommendations
    function generateStyleRecommendations(data) {
      // Use appearance profile to determine style recommendations
      const presentation = data.appearanceProfile?.presentation || 'ambiguous';
      const gender = presentation === 'male-presenting' ? 'male' : 
                     presentation === 'female-presenting' ? 'female' : 'neutral';
      const features = data.features || [];
      
      // Find relevant features
      const jawFeature = features.find(f => f.key === 'jawline' || f.key === 'chin');
      const skinFeature = features.find(f => f.key === 'skin' || f.key === 'skin_quality');
      
      // Haircut recommendations based on face shape analysis
      const haircuts = gender === 'male' ? [
        { name: 'Textured Crop', desc: 'Low maintenance, modern look. Works with most face shapes.', match: 'high', icon: 'ðŸ’ˆ' },
        { name: 'Fade with Length on Top', desc: 'Clean sides, versatile styling. Great for oval/square faces.', match: 'high', icon: 'âœ‚ï¸' },
        { name: 'Slicked Back Undercut', desc: 'Sophisticated, elongates face. Best for round faces.', match: 'medium', icon: 'ðŸ’‡' },
        { name: 'Classic Side Part', desc: 'Timeless, professional. Works for all face shapes.', match: 'high', icon: 'ðŸ‘”' },
      ] : [
        { name: 'Long Layers', desc: 'Adds movement and dimension. Universally flattering.', match: 'high', icon: 'ðŸ’‡â€â™€ï¸' },
        { name: 'Blunt Bob', desc: 'Modern, face-framing. Great for oval/heart faces.', match: 'high', icon: 'âœ‚ï¸' },
        { name: 'Curtain Bangs', desc: 'Soft, face-framing. Balances long/rectangular faces.', match: 'medium', icon: 'ðŸ’ˆ' },
        { name: 'Shoulder Length', desc: 'Versatile, easy to style. Works for most face shapes.', match: 'high', icon: 'ðŸ‘©' },
      ];

      // Brow recommendations
      const brows = [
        { name: 'Clean Up Strays', desc: 'Remove obvious strays between brows and under arch. Keep natural shape.', match: 'high', icon: 'ðŸŽ¯' },
        { name: 'Professional Shaping', desc: 'Visit a professional for initial shaping, then maintain at home.', match: 'medium', icon: 'âœ¨' },
      ];

      // Facial hair (for males)
      const facialHair = gender === 'male' ? [
        { name: 'Stubble', desc: 'Adds definition to jawline. Keep it groomed at 2-4mm.', match: jawFeature && jawFeature.rating10 < 6 ? 'high' : 'medium', icon: 'ðŸ§”' },
        { name: 'Short Beard', desc: 'Frames the face, can add perceived jaw width. Keep edges clean.', match: 'medium', icon: 'ðŸ§”â€â™‚ï¸' },
        { name: 'Clean Shaven', desc: 'Shows natural bone structure. Best for strong jawlines.', match: jawFeature && jawFeature.rating10 > 6 ? 'high' : 'medium', icon: 'ðŸª’' },
        { name: 'Goatee', desc: 'Elongates face, adds chin definition. Best for round faces.', match: 'medium', icon: 'ðŸ‘¨' },
      ] : [];

      // Glasses recommendations
      const glasses = [
        { name: 'Round Frames', desc: 'Softens angular features. Best for square/rectangular faces.', match: 'medium', icon: 'ðŸ‘“' },
        { name: 'Rectangular Frames', desc: 'Adds structure. Best for round/oval faces.', match: 'high', icon: 'ðŸ¤“' },
        { name: 'Aviators', desc: 'Classic shape. Works well for most face types.', match: 'high', icon: 'ðŸ•¶ï¸' },
        { name: 'Cat Eye (women)', desc: 'Lifts and adds angles. Great for round faces.', match: gender === 'female' ? 'high' : 'low', icon: 'ðŸ˜Ž' },
      ];

      // Skin routine
      const skinRoutine = {
        am: [
          'Gentle cleanser',
          'Vitamin C serum',
          'Moisturizer',
          'SPF 30+ sunscreen',
        ],
        pm: [
          'Oil-based cleanser (if wearing SPF)',
          'Gentle cleanser',
          'Retinol (start 2x/week)',
          'Moisturizer',
        ]
      };

      return { haircuts, brows, facialHair, glasses, skinRoutine };
    }

    // Display style recommendations
    function displayStyleRecommendations(styles) {
      // Haircuts
      document.getElementById('haircut-recommendations').innerHTML = styles.haircuts.map(h => `
        <div class="style-card">
          <div class="style-card-header">
            <span class="style-card-icon">${h.icon}</span>
            <h4>${h.name}</h4>
          </div>
          <p>${h.desc}</p>
          <span class="match-score ${h.match}">${h.match === 'high' ? 'âœ“ Great match' : 'Good option'}</span>
        </div>
      `).join('');

      // Brows
      document.getElementById('brow-recommendations').innerHTML = styles.brows.map(b => `
        <div class="style-card">
          <div class="style-card-header">
            <span class="style-card-icon">${b.icon}</span>
            <h4>${b.name}</h4>
          </div>
          <p>${b.desc}</p>
          <span class="match-score ${b.match}">${b.match === 'high' ? 'âœ“ Recommended' : 'Optional'}</span>
        </div>
      `).join('');

      // Facial hair
      const facialHairContainer = document.getElementById('facial-hair-recommendations');
      if (styles.facialHair.length > 0) {
        facialHairContainer.innerHTML = styles.facialHair.map(f => `
          <div class="style-card">
            <div class="style-card-header">
              <span class="style-card-icon">${f.icon}</span>
              <h4>${f.name}</h4>
            </div>
            <p>${f.desc}</p>
            <span class="match-score ${f.match}">${f.match === 'high' ? 'âœ“ Recommended' : 'Worth trying'}</span>
          </div>
        `).join('');
      } else {
        facialHairContainer.innerHTML = '<p style="color: var(--text-muted);">N/A for this analysis</p>';
      }

      // Glasses
      document.getElementById('glasses-recommendations').innerHTML = styles.glasses.filter(g => g.match !== 'low').map(g => `
        <div class="style-card">
          <div class="style-card-header">
            <span class="style-card-icon">${g.icon}</span>
            <h4>${g.name}</h4>
          </div>
          <p>${g.desc}</p>
          <span class="match-score ${g.match}">${g.match === 'high' ? 'âœ“ Great match' : 'Good option'}</span>
        </div>
      `).join('');

      // Skin routine
      document.getElementById('am-routine-steps').innerHTML = styles.skinRoutine.am.map((step, i) => 
        `<li data-step="${i + 1}">${step}</li>`
      ).join('');
      document.getElementById('pm-routine-steps').innerHTML = styles.skinRoutine.pm.map((step, i) => 
        `<li data-step="${i + 1}">${step}</li>`
      ).join('');
    }

    // Display progress gallery
    function displayProgressGallery() {
      const gallery = document.getElementById('progress-gallery');
      const emptyState = document.getElementById('progress-empty');
      const compareMode = document.getElementById('compare-mode');

      if (progressHistory.length === 0) {
        gallery.classList.add('hidden');
        emptyState.classList.remove('hidden');
        compareMode.classList.add('hidden');
      } else {
        gallery.classList.remove('hidden');
        emptyState.classList.add('hidden');
        
        gallery.innerHTML = progressHistory.slice(-8).reverse().map((item, i) => `
          <div class="progress-item" onclick="selectProgressItem(${progressHistory.length - 1 - i})">
            <img src="${item.thumbnail}" alt="Progress photo">
            <div class="progress-item-info">
              <div class="progress-item-date">${new Date(item.date).toLocaleDateString()}</div>
              <div class="progress-item-score">${item.score.toFixed(1)}/10</div>
            </div>
          </div>
        `).join('');

        // Show compare mode if we have at least 2 entries
        if (progressHistory.length >= 2) {
          compareMode.classList.remove('hidden');
          setupCompareSlider();
        }
      }
    }

    // Select progress item for comparison
    window.selectProgressItem = function(index) {
      // Could expand this to select before/after
      console.log('Selected progress item:', index);
    };

    // Save current scan to progress
    document.getElementById('save-progress-btn')?.addEventListener('click', function() {
      if (currentAnalysisData && frontImage) {
        const entry = {
          date: new Date().toISOString(),
          score: currentAnalysisData.overall?.currentScore10 || 5.0,
          potential: currentAnalysisData.overall?.potentialScore10 || 6.0,
          thumbnail: 'data:image/jpeg;base64,' + frontImage.substring(0, 100) + '...',
          scanType: currentScanType
        };
        
        // Store actual thumbnail (smaller version)
        entry.thumbnail = `data:image/jpeg;base64,${frontImage}`;
        
        progressHistory.push(entry);
        
        // Keep only last 20 entries
        if (progressHistory.length > 20) {
          progressHistory = progressHistory.slice(-20);
        }
        
        localStorage.setItem('glowup_progress', JSON.stringify(progressHistory.map(p => ({
          ...p,
          thumbnail: p.thumbnail.substring(0, 500) + '...' // Truncate for storage
        }))));
        
        displayProgressGallery();
        alert('âœ… Progress saved! Come back in a week to compare.');
      }
    });

    // Setup compare slider
    function setupCompareSlider() {
      if (progressHistory.length < 2) return;
      
      const before = progressHistory[0];
      const after = progressHistory[progressHistory.length - 1];
      
      const beforeImg = document.getElementById('compare-before');
      const afterImg = document.getElementById('compare-after');
      
      if (beforeImg && afterImg && before.thumbnail && after.thumbnail) {
        beforeImg.src = before.thumbnail;
        afterImg.src = after.thumbnail;
      }

      // Make slider draggable
      const slider = document.getElementById('compare-slider');
      const container = document.getElementById('compare-container');
      
      if (slider && container) {
        let isDragging = false;
        
        slider.addEventListener('mousedown', () => isDragging = true);
        document.addEventListener('mouseup', () => isDragging = false);
        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          const rect = container.getBoundingClientRect();
          let x = ((e.clientX - rect.left) / rect.width) * 100;
          x = Math.max(0, Math.min(100, x));
          slider.style.left = x + '%';
          afterImg.style.clipPath = `inset(0 ${100 - x}% 0 0)`;
        });
      }
    }

    // Show retake guidance if photo quality is poor
    function checkRetakeGuidance(data) {
      const retakeBox = document.getElementById('retake-guidance');
      if (data.photoQuality && data.photoQuality.score < 0.6) {
        retakeBox.classList.remove('hidden');
      } else {
        retakeBox.classList.add('hidden');
      }
    }

    // Mock results for demo mode (when server is offline)
    function getMockResults() {
      return {
        photoQuality: {
          score: 0.75,
          issues: ['side_missing'],
          assessmentLimitations: ['Chin projection cannot be accurately assessed without side profile']
        },
        overall: {
          currentScore10: 5.8,
          potentialScore10: 7.2,
          confidence: 'medium',
          summary: 'Demo Mode: You have good facial harmony with balanced features. Main opportunities are in skincare, grooming, and styling - all achievable improvements.',
          calibrationNote: 'This is demo data. For real AI analysis, the server needs to be running.'
        },
        potential: {
          totalPossibleGain: 1.4,
          deltas: [
            { lever: 'Skincare routine', currentIssue: 'Skin texture could be improved', delta: 0.5, timeline: '8-12 weeks', difficulty: 'easy', steps: ['Daily SPF', 'Retinol 2x/week', 'Hydration'] },
            { lever: 'Hairstyle optimization', currentIssue: 'Style could better complement face shape', delta: 0.4, timeline: '2-4 weeks', difficulty: 'easy', steps: ['Consult stylist', 'Try new products'] },
            { lever: 'Eyebrow grooming', currentIssue: 'Brows could be more defined', delta: 0.3, timeline: '1-2 weeks', difficulty: 'easy', steps: ['Shape brows', 'Fill if sparse'] }
          ],
          top3Levers: [
            { lever: 'Skincare routine', delta: 0.5, timeline: '8-12 weeks', priority: 1 },
            { lever: 'Hairstyle optimization', delta: 0.4, timeline: '2-4 weeks', priority: 2 },
            { lever: 'Eyebrow grooming', delta: 0.3, timeline: '1-2 weeks', priority: 3 }
          ],
          timelineToFullPotential: '10-14 weeks'
        },
        features: [
          { label: 'Skin Quality', rating10: 5.5, confidence: 'high', evidence: 'Demo: Even tone with minor texture', strengths: ['Even skin tone'], holdingBack: ['Minor texture'] },
          { label: 'Eye Area', rating10: 6.2, confidence: 'high', evidence: 'Demo: Good symmetry and shape', strengths: ['Symmetric eyes'], holdingBack: ['Could brighten'] },
          { label: 'Facial Harmony', rating10: 6.0, confidence: 'medium', evidence: 'Demo: Well-balanced proportions', strengths: ['Good proportions'], holdingBack: ['Minor asymmetry'] },
          { label: 'Jawline', rating10: 5.5, confidence: 'medium', evidence: 'Demo: Decent definition', strengths: ['Visible structure'], holdingBack: ['Could be more defined'] }
        ]
      };
    }

    function getMockBodyResults() {
      return {
        photoQuality: { score: 0.8, issues: [] },
        overall: {
          currentScore10: 5.5,
          potentialScore10: 7.0,
          confidence: 'medium',
          summary: 'Demo Mode: Good foundation with room for improvement in posture and muscle development.',
          calibrationNote: 'This is demo data. For real AI analysis, the server needs to be running.'
        },
        potential: {
          totalPossibleGain: 1.5,
          deltas: [
            { lever: 'Posture correction', currentIssue: 'Slight forward head posture', delta: 0.5, timeline: '4-8 weeks', difficulty: 'moderate', steps: ['Chin tucks', 'Wall angels', 'Ergonomic setup'] },
            { lever: 'Upper body development', currentIssue: 'Could improve shoulder-to-waist ratio', delta: 0.5, timeline: '12-16 weeks', difficulty: 'moderate', steps: ['Shoulder exercises', 'Back training'] },
            { lever: 'Core strengthening', currentIssue: 'Core stability could improve', delta: 0.3, timeline: '8-12 weeks', difficulty: 'easy', steps: ['Planks', 'Dead bugs'] }
          ],
          top3Levers: [
            { lever: 'Posture correction', delta: 0.5, timeline: '4-8 weeks', priority: 1 },
            { lever: 'Upper body development', delta: 0.5, timeline: '12-16 weeks', priority: 2 },
            { lever: 'Core strengthening', delta: 0.3, timeline: '8-12 weeks', priority: 3 }
          ],
          timelineToFullPotential: '14-18 weeks'
        },
        features: [
          { label: 'Posture', rating10: 5.0, confidence: 'high', evidence: 'Demo: Room for improvement', strengths: ['Aware of posture'], holdingBack: ['Forward head'] },
          { label: 'Proportions', rating10: 5.8, confidence: 'medium', evidence: 'Demo: Balanced build', strengths: ['Good frame'], holdingBack: ['Could improve ratio'] },
          { label: 'Muscle Definition', rating10: 5.5, confidence: 'medium', evidence: 'Demo: Foundation present', strengths: ['Some definition'], holdingBack: ['More development needed'] }
        ]
      };
    }

    // Enhanced displayResults - integrate new features
    const originalDisplayResults = displayResults;
    displayResults = function(data, isDemo = false) {
      // Store for other features
      currentAnalysisData = data;
      
      // Call original
      originalDisplayResults(data, isDemo);
      
      // Display delta breakdown
      displayDeltaBreakdown(data);
      
      // Check retake guidance
      checkRetakeGuidance(data);
      
      // Generate and display 14-day plan
      const plan = generate14DayPlan(data);
      currentAnalysisData.plan = plan;
      display14DayPlan(plan);
      updateWeeklyRecap();
      
      // Generate and display style recommendations
      const styles = generateStyleRecommendations(data);
      displayStyleRecommendations(styles);
      
      // Display progress gallery
      displayProgressGallery();
    };

    // ====== EXPANDABLE FEATURE CARDS ======

    // Toggle feature card expansion
    window.toggleFeatureCard = function(card) {
      const wasExpanded = card.classList.contains('expanded');
      
      // Close all other cards
      document.querySelectorAll('.feature-result-card.expanded').forEach(c => {
        if (c !== card) c.classList.remove('expanded');
      });
      
      // Toggle this card
      card.classList.toggle('expanded');
      
      // Scroll into view if expanding
      if (!wasExpanded) {
        setTimeout(() => {
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }
    };

    // Get icon for feature
    function getFeatureIcon(key) {
      const icons = {
        skin: 'âœ¨',
        eye_area: 'ðŸ‘ï¸',
        eyes: 'ðŸ‘ï¸',
        nose: 'ðŸ‘ƒ',
        lips: 'ðŸ‘„',
        jawline: 'ðŸ’Ž',
        jaw: 'ðŸ’Ž',
        cheekbones: 'ðŸŒŸ',
        hair: 'ðŸ’‡',
        brows: 'ðŸª®',
        harmony: 'âš–ï¸',
        symmetry: 'âš–ï¸',
        posture: 'ðŸ§˜',
        v_taper: 'ðŸ’ª',
        vtaper: 'ðŸ’ª',
        muscle_balance: 'ðŸ‹ï¸',
        core: 'ðŸŽ¯',
        overall_proportions: 'ðŸ“',
        lean_mass: 'ðŸ’ª',
        body_fat: 'ðŸ“Š'
      };
      return icons[key.toLowerCase().replace(/ /g, '_')] || 'ðŸ“Š';
    }

    // Generate detailed explanation for a feature
    function generateFeatureExplanation(feature, isBody = false) {
      const key = (feature.key || feature.label || '').toLowerCase().replace(/ /g, '_');
      const score = feature.rating10;
      const scoreLevel = score >= 7 ? 'above average' : score >= 5 ? 'average' : 'below average';
      
      // If feature has evidence/why, use it
      if (feature.evidence) return feature.evidence;
      if (feature.why && typeof feature.why === 'string') return feature.why;
      if (feature.why && Array.isArray(feature.why)) return feature.why.join(' ');
      
      // Generate contextual explanation based on feature type
      const explanations = {
        skin: {
          high: `Your skin texture and clarity score ${scoreLevel} at ${score.toFixed(1)}. This indicates good skin health with minimal visible concerns. Your skin tone appears even, and texture looks smooth. Maintaining your current routine is working well, though there's always room for optimization.`,
          mid: `Your skin scores ${score.toFixed(1)}/10, which is ${scoreLevel}. There may be some unevenness in skin tone or minor texture concerns visible. These are common and highly improvable with a consistent skincare routine. Photo lighting can also affect this assessment.`,
          low: `Your skin currently scores ${score.toFixed(1)}/10. There appear to be visible concerns like uneven tone, texture irregularities, or minor blemishes. The good news: skin is one of the most modifiable features. A targeted routine can improve this significantly within 4-8 weeks.`
        },
        eye_area: {
          high: `Your eye area scores ${score.toFixed(1)}/10 (${scoreLevel}). Eye spacing is proportionate, with good clarity in the sclera and minimal under-eye concerns. The palpebral fissure (eye opening) appears balanced and well-defined.`,
          mid: `Your eye area scores ${score.toFixed(1)}/10, which is ${scoreLevel}. Eye proportions are within normal ranges. There may be slight under-eye shadows or minor asymmetry, which is extremely common. Lifestyle factors like sleep and hydration significantly impact this area.`,
          low: `Your eye area currently scores ${score.toFixed(1)}/10. There may be noticeable under-eye circles, puffiness, or spacing concerns. This area is heavily influenced by sleep quality, hydration, and genetics. Many improvements are possible through lifestyle changes.`
        },
        eyes: {
          high: `Your eyes score ${score.toFixed(1)}/10 (${scoreLevel}). Eye shape, spacing, and symmetry are favorable. The canthal tilt (eye angle) appears balanced, contributing to overall facial harmony.`,
          mid: `Your eyes score ${score.toFixed(1)}/10. Eye proportions fall within typical ranges with minor variations. Small asymmetries are completely normalâ€”perfect symmetry doesn't exist naturally.`,
          low: `Your eyes score ${score.toFixed(1)}/10. There may be spacing or proportion concerns affecting this score. Remember that lighting and photo angle significantly impact eye measurements.`
        },
        nose: {
          high: `Your nose scores ${score.toFixed(1)}/10 (${scoreLevel}). Nasal width to face ratio is proportionate, and the bridge appears well-defined. This contributes positively to overall facial harmony.`,
          mid: `Your nose scores ${score.toFixed(1)}/10. Proportions are within typical ranges. The nose-to-face width ratio is acceptable, though minor variations exist. Contouring techniques can enhance appearance for photos if desired.`,
          low: `Your nose currently scores ${score.toFixed(1)}/10. The width-to-face ratio may fall outside typical ranges. Note that nose projection and profile cannot be fully assessed without a side photo. Photo angle also significantly affects nasal appearance.`
        },
        lips: {
          high: `Your lips score ${score.toFixed(1)}/10 (${scoreLevel}). Lip fullness and definition appear proportionate, with good vermillion border visibility. The upper-to-lower lip ratio is balanced.`,
          mid: `Your lips score ${score.toFixed(1)}/10. Proportions are typical, with room for enhancement through hydration and care. The philtrum and cupid's bow contribute to overall lip aesthetics.`,
          low: `Your lips score ${score.toFixed(1)}/10. There may be concerns with fullness, definition, or symmetry. Lip care routines and proper hydration can noticeably improve lip appearance.`
        },
        jawline: {
          high: `Your jawline scores ${score.toFixed(1)}/10 (${scoreLevel}). Good jaw definition is visible, with a favorable jaw-to-face width ratio. This provides strong facial structure.`,
          mid: `Your jawline scores ${score.toFixed(1)}/10. Definition is average, which is affected by body composition, posture, and photo lighting. A side profile photo would provide more accurate assessment.`,
          low: `Your jawline currently scores ${score.toFixed(1)}/10. Definition may be obscured by lighting, angle, or body composition factors. Posture exercises and body recomposition can significantly improve jaw appearance. Note: without a side photo, this assessment has lower confidence.`
        },
        cheekbones: {
          high: `Your cheekbones score ${score.toFixed(1)}/10 (${scoreLevel}). Good prominence and positioning contribute to facial structure and light reflection, creating attractive shadows.`,
          mid: `Your cheekbones score ${score.toFixed(1)}/10. Prominence is average, which is typical. Cheekbone visibility is heavily affected by lighting conditions and can be enhanced with contouring for photos.`,
          low: `Your cheekbones score ${score.toFixed(1)}/10. Prominence assessment is difficult from photos and heavily lighting-dependent. Body composition changes can reveal more cheekbone definition over time.`
        },
        hair: {
          high: `Your hair scores ${score.toFixed(1)}/10 (${scoreLevel}). Current style complements your face shape well, with good volume and health appearance.`,
          mid: `Your hair scores ${score.toFixed(1)}/10. There's opportunity to optimize your style for your face shape. Hair is one of the highest-impact, quickest-to-change features.`,
          low: `Your hair currently scores ${score.toFixed(1)}/10. Style or presentation may not be optimized for your face shape. This is excellent newsâ€”hair is the #1 most improvable feature with immediate results.`
        },
        harmony: {
          high: `Your facial harmony scores ${score.toFixed(1)}/10 (${scoreLevel}). Features work well together with good proportion relationships and symmetry within normal ranges.`,
          mid: `Your facial harmony scores ${score.toFixed(1)}/10. Overall proportions are typical with minor variations. Perfect harmony is rareâ€”most faces have small asymmetries that add character.`,
          low: `Your facial harmony currently scores ${score.toFixed(1)}/10. There may be proportion imbalances affecting the overall aesthetic. Individual feature improvements often improve harmony scores as well.`
        },
        posture: {
          high: `Your posture scores ${score.toFixed(1)}/10 (${scoreLevel}). Good spinal alignment and shoulder positioning are visible, which enhances overall body presentation.`,
          mid: `Your posture scores ${score.toFixed(1)}/10. There's room for improvement in alignment. Posture significantly impacts how physique is perceived and is highly improvable with consistent effort.`,
          low: `Your posture currently scores ${score.toFixed(1)}/10. Forward head position or rounded shoulders may be present. The good news: posture is 100% trainable with targeted exercises over 2-4 weeks.`
        },
        v_taper: {
          high: `Your V-taper scores ${score.toFixed(1)}/10 (${scoreLevel}). Shoulder-to-waist ratio is favorable, creating an athletic silhouette.`,
          mid: `Your V-taper scores ${score.toFixed(1)}/10. The shoulder-to-waist ratio is average. Building lat width and reducing waist circumference can improve this ratio.`,
          low: `Your V-taper currently scores ${score.toFixed(1)}/10. The shoulder-to-waist ratio has room for improvement. This is a trainable metric through targeted lat development and body recomposition.`
        }
      };

      // Find matching explanation
      const level = score >= 7 ? 'high' : score >= 5 ? 'mid' : 'low';
      for (const [k, v] of Object.entries(explanations)) {
        if (key.includes(k)) return v[level];
      }

      // Default explanation
      return `This feature scores ${score.toFixed(1)}/10, which is ${scoreLevel} based on our calibrated scoring system (where 5.5 is average). ${
        score >= 6 ? 'This is a relative strength.' : 
        score >= 4.5 ? 'This falls within typical ranges with room for enhancement.' : 
        'There are clear opportunities for improvement in this area.'
      } Click "Get Recommendations" below for specific products and routines to optimize this feature.`;
    }

    // Open recommendation modal
    window.openRecommendModal = function(featureKey, featureLabel, featureScore) {
      const modal = document.getElementById('recommend-modal');
      const modalTitle = document.getElementById('recommend-modal-title');
      const modalBody = document.getElementById('recommend-modal-body');
      
      modalTitle.innerHTML = `<span>ðŸ›’</span> ${featureLabel} Recommendations`;
      
      // Show loading state
      modalBody.innerHTML = `
        <div class="recommend-loading">
          <div class="spinner"></div>
          <p>Generating personalized recommendations...</p>
        </div>
      `;
      
      modal.classList.add('active');
      
      // Generate recommendations
      setTimeout(() => {
        const recommendations = generateProductRecommendations(featureKey, featureScore);
        displayRecommendations(modalBody, recommendations, featureKey);
      }, 1200);
    };

    // Close recommendation modal
    window.closeRecommendModal = function() {
      document.getElementById('recommend-modal').classList.remove('active');
    };

    // Generate product recommendations based on feature
    function generateProductRecommendations(featureKey, score) {
      const key = featureKey.toLowerCase().replace(/ /g, '_');
      
      const recommendations = {
        skin: [
          {
            name: 'Gentle Cleanser (CeraVe, La Roche-Posay, or Vanicream)',
            type: 'Essential',
            description: 'Start with a gentle, non-stripping cleanser. Avoid harsh sulfates. Use morning and night as the foundation of your routine.',
            tips: 'Look for "for sensitive skin" labels. Foam or gel for oily skin, cream for dry skin.'
          },
          {
            name: 'Niacinamide Serum (The Ordinary, Paula\'s Choice)',
            type: 'Active',
            description: 'Niacinamide (Vitamin B3) helps with pore appearance, uneven tone, and overall skin texture. Use daily in the morning.',
            tips: 'Start with 5-10% concentration. Can be layered with most other products.'
          },
          {
            name: 'Moisturizer with Ceramides',
            type: 'Essential',
            description: 'Maintains skin barrier health. Apply morning and night after serums.',
            tips: 'CeraVe PM or Vanicream are solid affordable options. Heavier creams for dry skin, lighter lotions for oily.'
          },
          {
            name: 'SPF 30+ Sunscreen (Daily)',
            type: 'Essential',
            description: 'The single most important anti-aging product. Protects against UV damage and prevents dark spots.',
            tips: 'Reapply every 2 hours when outside. Look for "broad spectrum" coverage.'
          },
          {
            name: 'Retinol (Start Low, Go Slow)',
            type: 'Advanced',
            description: 'Gold standard for skin texture and tone. Start with 0.25% retinol 2x/week, gradually increase.',
            tips: 'Only use at night. Always use sunscreen when using retinol. Expect purging in first 2-4 weeks.'
          }
        ],
        eye_area: [
          {
            name: 'Caffeine Eye Serum (The Ordinary, INKEY List)',
            type: 'Targeted',
            description: 'Caffeine reduces puffiness and temporarily tightens the under-eye area. Apply morning and night.',
            tips: 'Keep in refrigerator for extra de-puffing effect. Pat gently, don\'t rub.'
          },
          {
            name: 'Vitamin C Eye Cream',
            type: 'Brightening',
            description: 'Helps with dark circles by brightening the delicate under-eye skin over time.',
            tips: 'Look for stable Vitamin C forms like ascorbyl glucoside. Use in the morning.'
          },
          {
            name: 'Cold Compress or Ice Roller',
            type: 'Tool',
            description: 'Reduces morning puffiness and inflammation. Use for 2-3 minutes after waking.',
            tips: 'Store in freezer. Also helps product absorption when used before serums.'
          },
          {
            name: 'Sleep Optimization',
            type: 'Lifestyle',
            description: 'Aim for 7-9 hours consistent sleep. Nothing replaces proper rest for under-eye appearance.',
            tips: 'Sleep on your back with head slightly elevated to reduce fluid accumulation.'
          }
        ],
        eyes: [
          {
            name: 'Lash Serum (Grande Lash, RevitaLash)',
            type: 'Enhancement',
            description: 'Promotes lash growth and thickness, making eyes appear more defined.',
            tips: 'Apply to lash line nightly. Results visible in 4-8 weeks.'
          },
          {
            name: 'Brow Gel (Clear or Tinted)',
            type: 'Grooming',
            description: 'Well-groomed brows frame the eyes. Use to keep brows in place and add definition.',
            tips: 'Brush upward for a lifted look. Boy Brow, NYX, or drugstore options work well.'
          }
        ],
        nose: [
          {
            name: 'Pore Strips (Occasional Use)',
            type: 'Treatment',
            description: 'Can help with blackheads on nose area when used sparingly (1-2x per week max).',
            tips: 'Don\'t overuseâ€”can irritate skin. Follow with a BHA like salicylic acid for maintenance.'
          },
          {
            name: 'Salicylic Acid Cleanser',
            type: 'Maintenance',
            description: 'BHA penetrates pores to keep them clear. Great for nose area where pores are often more visible.',
            tips: 'Use 2-3x per week, not daily. Paula\'s Choice BHA is a cult favorite.'
          },
          {
            name: 'Contouring Palette (For Photos)',
            type: 'Makeup',
            description: 'Learn basic nose contouring for photos if desired. Shade sides, highlight bridge.',
            tips: 'Use matte products only. Blend well. For photos onlyâ€”too obvious in person.'
          }
        ],
        lips: [
          {
            name: 'Exfoliating Lip Scrub',
            type: 'Treatment',
            description: 'Removes dead skin for smoother, more defined lips. Use 1-2x per week.',
            tips: 'Can DIY with sugar + honey. Be gentleâ€”lip skin is delicate.'
          },
          {
            name: 'Hydrating Lip Balm (Aquaphor, Lanolips)',
            type: 'Essential',
            description: 'Keep lips hydrated 24/7. Dehydrated lips look thinner and less defined.',
            tips: 'Avoid lip balms with menthol or camphorâ€”they can be drying long-term.'
          },
          {
            name: 'Lip Sleeping Mask (Laneige)',
            type: 'Treatment',
            description: 'Overnight intense hydration for noticeably softer, plumper lips by morning.',
            tips: 'Apply generous layer before bed. Game-changer for dry climates.'
          }
        ],
        jawline: [
          {
            name: 'Gua Sha / Face Roller',
            type: 'Tool',
            description: 'Facial massage promotes lymphatic drainage, reducing puffiness and enhancing definition.',
            tips: 'Use with facial oil. Stroke upward and outward. 5 minutes daily.'
          },
          {
            name: 'Chin Tuck Exercises',
            type: 'Exercise',
            description: 'Strengthens neck muscles and improves posture, making jaw appear more defined.',
            tips: '3 sets of 10 reps daily. Hold each rep 3 seconds. Results in 2-4 weeks.'
          },
          {
            name: 'Reduce Sodium Intake',
            type: 'Lifestyle',
            description: 'High sodium causes water retention, softening jaw definition.',
            tips: 'Limit processed foods. Drink more water. Notice changes in 3-7 days.'
          },
          {
            name: 'Body Recomposition',
            type: 'Long-term',
            description: 'Lower body fat reveals underlying jaw structure. The most impactful change for jawline.',
            tips: 'Focus on slight caloric deficit + strength training. 8-12 week timeline.'
          }
        ],
        cheekbones: [
          {
            name: 'Contouring (Cream or Powder)',
            type: 'Makeup',
            description: 'Strategic shading below cheekbones creates the appearance of more prominence.',
            tips: 'Use cool-toned shades. Blend upward. Less is more.'
          },
          {
            name: 'Highlighter (Subtle)',
            type: 'Makeup',
            description: 'Applied to tops of cheekbones, catches light and emphasizes bone structure.',
            tips: 'Avoid glitter. Cream highlighters look more natural. Apply after foundation.'
          },
          {
            name: 'Facial Exercises',
            type: 'Exercise',
            description: 'Smile exercises and cheek lifts can subtly tone facial muscles over time.',
            tips: 'Results are subtle but cumulative. Consistency matters more than intensity.'
          }
        ],
        hair: [
          {
            name: 'Face Shape Analysis Haircut',
            type: 'Service',
            description: 'Consult a stylist about cuts that complement your face shape. Show them reference photos.',
            tips: 'Bring 3-5 photos of styles you like. Ask about maintenance requirements.'
          },
          {
            name: 'Quality Styling Products',
            type: 'Essential',
            description: 'The right product makes a huge difference. Pomade for control, clay for texture, sea salt spray for volume.',
            tips: 'Start with small amounts. Hanz de Fuko, Baxter, or Suavecito are solid options.'
          },
          {
            name: 'Regular Trims (Every 4-6 Weeks)',
            type: 'Maintenance',
            description: 'Keeps your cut looking fresh and intentional rather than grown-out.',
            tips: 'Find a barber/stylist you trust and stick with them. Communication is key.'
          }
        ],
        harmony: [
          {
            name: 'Consistent Skincare Across Face',
            type: 'Routine',
            description: 'Even skin tone across all features improves overall harmony perception.',
            tips: 'Don\'t neglect forehead, temples, and jawline in your routine.'
          },
          {
            name: 'Brow Shaping',
            type: 'Grooming',
            description: 'Well-shaped brows that suit your face significantly improve perceived harmony.',
            tips: 'Professional shaping first, then maintain at home. Don\'t over-pluck.'
          },
          {
            name: 'Photo Angle Practice',
            type: 'Skill',
            description: 'Learning your best angles for photos can dramatically improve how your features appear together.',
            tips: 'Slight chin forward, camera at eye level or slightly above. Find your "better side."'
          }
        ],
        posture: [
          {
            name: 'Posture Corrector (Short-term)',
            type: 'Tool',
            description: 'Trains muscle memory for proper alignment. Use 30 min/day while building strength.',
            tips: 'Don\'t rely on it foreverâ€”use it to learn the feeling of proper posture.'
          },
          {
            name: 'Chin Tuck & Wall Angel Exercises',
            type: 'Exercise',
            description: 'Strengthens the muscles needed to maintain good posture naturally.',
            tips: 'Chin tucks: 3x10 daily. Wall angels: 2x15 daily. Results in 2-4 weeks.'
          },
          {
            name: 'Ergonomic Workspace Setup',
            type: 'Environment',
            description: 'Monitor at eye level, keyboard at elbow height. Prevents posture degradation during work.',
            tips: 'Consider a standing desk converter. Take movement breaks every 30 minutes.'
          }
        ],
        v_taper: [
          {
            name: 'Lat-Focused Training',
            type: 'Exercise',
            description: 'Pull-ups, lat pulldowns, and rows build width. Focus on mind-muscle connection.',
            tips: 'Wide grip for width. 3x per week. Progressive overload over time.'
          },
          {
            name: 'Core Work + Vacuum Exercises',
            type: 'Exercise',
            description: 'Strong core and stomach vacuums create a tighter waist, improving the V-taper ratio.',
            tips: 'Vacuums: 3 sets of 20-30 second holds daily. Game-changer for waist tightness.'
          },
          {
            name: 'Caloric Deficit (If Needed)',
            type: 'Nutrition',
            description: 'Reducing waist size through fat loss dramatically improves V-taper appearance.',
            tips: '200-500 calorie deficit. High protein. Be patientâ€”8-12 weeks minimum.'
          }
        ]
      };

      // Find matching recommendations
      for (const [k, recs] of Object.entries(recommendations)) {
        if (key.includes(k)) return recs;
      }

      // Default recommendations
      return [
        {
          name: 'Consistent Daily Routine',
          type: 'Foundation',
          description: 'The most important factor is consistency. Pick 2-3 targeted actions and do them daily.',
          tips: 'Track your habits. Results come from accumulated small efforts over time.'
        },
        {
          name: 'Quality Sleep (7-9 Hours)',
          type: 'Lifestyle',
          description: 'Almost every aesthetic metric improves with better sleep. This is foundational.',
          tips: 'Consistent sleep schedule matters more than total hours. Avoid screens before bed.'
        },
        {
          name: 'Hydration (8+ Glasses Daily)',
          type: 'Lifestyle',
          description: 'Proper hydration improves skin, reduces puffiness, and enhances overall appearance.',
          tips: 'Start your day with water. Carry a bottle. Add electrolytes if needed.'
        }
      ];
    }

    // Display recommendations in modal
    function displayRecommendations(container, recommendations, featureKey) {
      container.innerHTML = `
        <div class="recommend-product-list">
          ${recommendations.map(rec => `
            <div class="recommend-product">
              <div class="recommend-product-header">
                <span class="recommend-product-name">${rec.name}</span>
                <span class="recommend-product-type">${rec.type}</span>
              </div>
              <p class="recommend-product-desc">${rec.description}</p>
              <p class="recommend-product-tips">ðŸ’¡ ${rec.tips}</p>
            </div>
          `).join('')}
        </div>
        <div class="recommend-disclaimer">
          âš ï¸ <strong>Disclaimer:</strong> These are general recommendations for educational purposes. 
          Results vary by individual. Consult a dermatologist or professional for personalized advice. 
          Always patch-test new products. We are not affiliated with any brands mentioned.
        </div>
      `;
    }

    // Close modal on outside click
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('recommend-modal');
      if (e.target === modal) {
        closeRecommendModal();
      }
    });

    // Close modal on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeRecommendModal();
        closeBestVersionModal();
      }
    });

    // ============================================
    // BEST VERSION GENERATOR
    // ============================================
    
    const BEST_VERSION_LOADING_MESSAGES = [
      'Analyzing your features...',
      'Enhancing lighting...',
      'Refining skin texture...',
      'Optimizing hair styling...',
      'Adding finishing touches...',
      'Almost there...'
    ];

    let bestVersionLoadingInterval = null;
    let bestVersionMessageIndex = 0;
    let currentOriginalImage = null;
    let currentEnhancedImage = null;

    // Best Version CTA click handler
    document.getElementById('best-version-cta')?.addEventListener('click', function() {
      openBestVersionModal();
    });

    // Close button handler
    document.getElementById('best-version-close')?.addEventListener('click', function() {
      closeBestVersionModal();
    });

    // Backdrop click handler
    document.querySelector('.best-version-modal-backdrop')?.addEventListener('click', function() {
      closeBestVersionModal();
    });

    // Retry button handler
    document.getElementById('best-version-retry')?.addEventListener('click', function() {
      closeBestVersionModal();
    });

    // Toggle buttons
    document.querySelectorAll('.best-version-toggle-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const view = this.dataset.view;
        document.querySelectorAll('.best-version-toggle-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const img = document.getElementById('best-version-image');
        const badge = document.getElementById('best-version-badge');
        
        if (view === 'before' && currentOriginalImage) {
          img.src = currentOriginalImage;
          badge.style.display = 'none';
        } else if (view === 'after' && currentEnhancedImage) {
          img.src = currentEnhancedImage;
          badge.style.display = 'flex';
        }
      });
    });

    function openBestVersionModal() {
      const modal = document.getElementById('best-version-modal');
      const loading = document.getElementById('best-version-loading');
      const results = document.getElementById('best-version-results');
      
      modal.classList.add('active');
      loading.style.display = 'block';
      results.style.display = 'none';
      
      // Set loading image to current uploaded image (using global frontImage variable)
      if (frontImage) {
        document.getElementById('best-version-loading-image').style.backgroundImage = 
          `url(data:image/jpeg;base64,${frontImage})`;
        currentOriginalImage = `data:image/jpeg;base64,${frontImage}`;
      }
      
      // Start loading animation
      bestVersionMessageIndex = 0;
      updateBestVersionLoadingMessage();
      bestVersionLoadingInterval = setInterval(() => {
        bestVersionMessageIndex = (bestVersionMessageIndex + 1) % BEST_VERSION_LOADING_MESSAGES.length;
        updateBestVersionLoadingMessage();
      }, 2500);
      
      // Generate best version
      generateBestVersion();
    }

    function updateBestVersionLoadingMessage() {
      const textEl = document.getElementById('best-version-loading-text');
      if (textEl) {
        textEl.textContent = BEST_VERSION_LOADING_MESSAGES[bestVersionMessageIndex];
      }
      
      // Update progress dots
      document.querySelectorAll('.best-version-progress-dot').forEach((dot, idx) => {
        dot.classList.toggle('active', idx <= bestVersionMessageIndex);
      });
    }

    function closeBestVersionModal() {
      const modal = document.getElementById('best-version-modal');
      if (modal) {
        modal.classList.remove('active');
      }
      
      if (bestVersionLoadingInterval) {
        clearInterval(bestVersionLoadingInterval);
        bestVersionLoadingInterval = null;
      }
    }

    async function generateBestVersion() {
      try {
        const response = await fetch(`${API_URL}/api/best-version`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            image: frontImage
          })
        });

        if (!response.ok) {
          throw new Error('Server error');
        }

        const data = await response.json();
        showBestVersionResults(data);
        
      } catch (error) {
        console.error('Best version generation error:', error);
        // Show fallback results
        showBestVersionResults({
          resultImageUrl: null,
          changes: [
            'Enhanced skin clarity with improved texture and even tone',
            'Optimized lighting for a more flattering appearance',
            'Refined hair styling for better face framing',
            'Subtle under-eye brightening',
            'Improved overall color balance and warmth'
          ],
          debug: {
            usedProvider: 'fallback',
            fallbackMode: true
          }
        });
      }
    }

    function showBestVersionResults(data) {
      // Stop loading animation
      if (bestVersionLoadingInterval) {
        clearInterval(bestVersionLoadingInterval);
        bestVersionLoadingInterval = null;
      }

      const loading = document.getElementById('best-version-loading');
      const results = document.getElementById('best-version-results');
      const img = document.getElementById('best-version-image');
      const fallbackNotice = document.getElementById('best-version-fallback-notice');
      const changesList = document.getElementById('best-version-changes-list');
      
      // Set images
      if (data.resultImageUrl) {
        // Handle both relative and absolute URLs
        currentEnhancedImage = data.resultImageUrl.startsWith('http') 
          ? data.resultImageUrl 
          : `${API_URL}${data.resultImageUrl}`;
      } else {
        currentEnhancedImage = currentOriginalImage;
      }
      
      img.src = currentEnhancedImage;
      
      // Show/hide fallback notice
      if (data.debug?.fallbackMode) {
        fallbackNotice.style.display = 'flex';
      } else {
        fallbackNotice.style.display = 'none';
      }
      
      // Populate changes list
      changesList.innerHTML = data.changes.map((change, idx) => `
        <div class="best-version-change-item">
          <span class="best-version-change-number">${idx + 1}</span>
          <span class="best-version-change-text">${change}</span>
        </div>
      `).join('');
      
      // Reset toggle to "After"
      document.querySelectorAll('.best-version-toggle-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === 'after');
      });
      document.getElementById('best-version-badge').style.display = 'flex';
      
      // Show results
      loading.style.display = 'none';
      results.style.display = 'block';
    }
  </script>

  <!-- Recommendation Modal -->
  <div id="recommend-modal" class="recommend-modal">
    <div class="recommend-modal-content">
      <div class="recommend-modal-header">
        <h3 id="recommend-modal-title" class="recommend-modal-title">Recommendations</h3>
        <button class="recommend-modal-close" onclick="closeRecommendModal()">Ã—</button>
      </div>
      <div id="recommend-modal-body" class="recommend-modal-body">
        <!-- Recommendations loaded dynamically -->
      </div>
    </div>
  </div>
</body>
</html>
